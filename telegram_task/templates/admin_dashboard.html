<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Dashboard - GoodDollar Analytics</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 14px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            color: #f1f5f9;
            overflow-x: hidden;
        }

        .navbar {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-brand {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .admin-layout {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* Sidebar Styles */
        .sidebar {
            width: 220px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(239, 68, 68, 0.2);
            padding: 1.5rem 0;
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .sidebar-menu {
            list-style: none;
        }

        .menu-item {
            margin: 0.5rem 1rem;
        }

        .menu-link {
            display: flex;
            align-items: center;
            padding: 0.6rem 0.8rem;
            color: rgba(241, 245, 249, 0.7);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .menu-link:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .menu-link.active {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .menu-icon {
            font-size: 1.2rem;
            margin-right: 0.75rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        /* Admin Sections */
        .admin-section {
            display: none;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .admin-section.active {
            display: block;
        }

        .admin-section h2 {
            margin-bottom: 1rem;
            color: #f1f5f9;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .admin-section h3 {
            margin-bottom: 1rem;
            color: #6366f1; /* Primary color for emphasis */
            font-size: 1.2rem;
            font-weight: 600;
        }

        .admin-section p {
            font-size: 0.9rem;
            color: rgba(241, 245, 249, 0.7);
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: rgba(241, 245, 249, 0.9);
        }

        .admin-input, .form-control {
            display: block;
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #f1f5f9;
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        .admin-input:focus, .form-control:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.25);
        }

        .admin-btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .admin-btn:hover {
            background-color: #a855f7;
            transform: translateY(-2px);
        }
        .admin-btn:active {
            transform: translateY(0);
        }

        .admin-btn.danger {
            background-color: #ef4444;
        }
        .admin-btn.danger:hover {
            background-color: #dc2626;
        }

        .status-message {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            display: none;
        }
        .status-message.success {
            background-color: rgba(16, 185, 129, 0.15);
            color: #10b981;
        }
        .status-message.error {
            background-color: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }
        .status-message.warning {
            background-color: rgba(251, 191, 36, 0.15);
            color: #fbbf24;
        }

        /* Tab buttons for admin sections */
        .tab-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .tab-btn {
            padding: 0.6rem 1.2rem;
            border: 1px solid rgba(239, 68, 68, 0.3);
            background: rgba(255, 255, 255, 0.05);
            color: rgba(241, 245, 249, 0.8);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border-color: transparent;
        }

        .tab-btn.active:hover {
            background: linear-gradient(135deg, #dc2626, #a40000);
        }

        /* Section Container */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(239, 68, 68, 0.3);
        }

        .stat-label {
            color: rgba(241, 245, 249, 0.7);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #f1f5f9;
        }

        .content-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .content-box h2 {
            margin-bottom: 1rem;
            color: #f1f5f9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 1rem;
            border-bottom: 2px solid rgba(239, 68, 68, 0.3);
            font-weight: 600;
            color: rgba(241, 245, 249, 0.9);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #a855f7);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(239, 68, 68, 0.3);
            border-top: 3px solid #ef4444;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            html {
                font-size: 13px;
            }

            .sidebar {
                width: 180px;
            }

            .menu-link {
                font-size: 0.85rem;
                padding: 0.5rem 0.6rem;
            }

            .page-title {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            html {
                font-size: 12px;
            }

            .admin-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                top: 0;
                border-right: none;
                border-bottom: 1px solid rgba(239, 68, 68, 0.2);
            }

            .main-content {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Alert styles from Bootstrap */
        .alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: 0.25rem;
        }
        .alert-info {
            color: #0c5460;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }
        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .alert-warning {
            color: #856404;
            background-color: #fff3cd;
            border-color: #ffeeba;
        }
        .text-muted {
            color: rgba(241, 245, 249, 0.7) !important;
        }
        .text-info {
            color: #17a2b8 !important;
        }
        .text-success {
            color: #28a745 !important;
        }
        .text-danger {
            color: #dc3545 !important;
        }
        .text-warning {
            color: #ffc107 !important;
        }
        .text-center {
            text-align: center !important;
        }
        .mb-0 {
            margin-bottom: 0 !important;
        }
        .mb-2 {
            margin-bottom: 0.5rem !important;
        }
        .mb-3 {
            margin-bottom: 1rem !important;
        }
        .mb-4 {
            margin-bottom: 1.5rem !important;
        }
        .mt-3 {
            margin-top: 1rem !important;
        }
        .w-100 {
            width: 100% !important;
        }
        .border {
            border: 1px solid #dee2e6 !important;
        }
        .rounded {
            border-radius: 0.25rem !important;
        }
        .p-2 {
            padding: 0.5rem !important;
        }
        .shadow-sm {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075) !important;
        }
        .bg-primary {
            background-color: #6366f1 !important;
        }
        .text-white {
            color: #fff !important;
        }
        .form-label {
            margin-bottom: 0.5rem;
            display: block;
            font-weight: 600;
            color: rgba(241, 245, 249, 0.9);
        }
        .form-control {
            display: block;
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #f1f5f9;
            background-color: rgba(255,255,255,0.1);
            background-clip: padding-box;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            box-sizing: border-box;
        }
        .form-control:focus {
            color: #f1f5f9;
            background-color: rgba(255,255,255,0.15);
            border-color: #a855f7;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
        }
        .btn-outline-primary {
            color: #6366f1;
            background-color: transparent;
            border-color: #6366f1;
        }
        .btn-outline-primary:hover {
            color: #fff;
            background-color: #6366f1;
            border-color: #6366f1;
        }
        .fas, .far, .fab {
            font-family: 'Font Awesome 5 Free';
        }
        .fa-camera, .fa-external-link-alt, .fa-save, .fa-upload, .fa-spinner, .fa-check-circle, .fa-exclamation-circle {
            font-weight: 900;
        }

        /* Custom styles for the module links section */
        .admin-input {
            display: block;
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #f1f5f9;
            font-size: 1rem;
            box-sizing: border-box;
        }
        .admin-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.25);
        }
        .admin-btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        .admin-btn:hover {
            background-color: #a855f7;
        }
        .module-link-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .module-link-item div {
            flex: 1;
        }
        .module-link-item p {
            font-size: 0.9rem;
            color: rgba(241, 245, 249, 0.8);
            margin-top: 0.5rem;
        }
        .module-link-item strong {
            font-size: 1.1rem;
            color: #f1f5f9;
        }
        .module-link-item button {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            background: #ef4444;
        }
        .module-link-item button:hover {
            background: #dc2626;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">üîê Admin Dashboard</div>
        <div style="color: rgba(241, 245, 249, 0.7); font-size: 0.9rem;">
            Admin: {{ wallet[:8] if wallet else 'Unknown' }}...
        </div>
        <a href="/dashboard" class="btn btn-primary">Back to Dashboard</a>
    </nav>

    <div class="admin-layout">
        <!-- Sidebar Menu -->
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li class="menu-item">
                    <a class="menu-link active" onclick="showSection('overview-section')">
                        <span class="menu-icon">üìä</span>
                        <span>Overview</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('users-section')">
                        <span class="menu-icon">üë•</span>
                        <span>Users Management</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('community-stories-section')">
                        <span class="menu-icon">üåü</span>
                        <span>Community Stories</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('daily-tasks-section')">
                        <span class="menu-icon">‚úÖ</span>
                        <span>Daily Tasks Mgmt</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('quiz-section')">
                        <span class="menu-icon">üìö</span>
                        <span>Quiz Questions</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('maintenance-section')">
                        <span class="menu-icon">üîß</span>
                        <span>Learn & Earn Maintenance</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('minigames-maintenance-section')">
                        <span class="menu-icon">üéÆ</span>
                        <span>Minigames Maintenance</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('quiz-settings-section')">
                        <span class="menu-icon">‚öôÔ∏è</span>
                        <span>Quiz Settings</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('community-stories-settings-section')">
                        <span class="menu-icon">üåü</span>
                        <span>Community Stories Settings</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('insufficient-balance-section')">
                        <span class="menu-icon">üí∞</span>
                        <span>Balance Error Message</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('broadcast-messages-section')">
                        <span class="menu-icon">üì¢</span>
                        <span>Broadcast Messages</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('news-management-section')">
                        <span class="menu-icon">üì∞</span>
                        <span>News Management</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('module-links-section')">
                        <span class="menu-icon">üîó</span>
                        <span>Module Links</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('reward-config-section')">
                        <span class="menu-icon">üí∞</span>
                        <span>Reward Config</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="showSection('developer-profile-section')">
                        <span class="menu-icon">üë®‚Äçüíª</span>
                        <span>Developer Profile</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Overview Section -->
            <section id="overview-section" class="section active">
                <div class="page-header">
                    <h1 class="page-title">‚ö° Platform Overview</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Monitor platform statistics and performance</p>
                </div>

                <div class="stats-grid" id="statsGrid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading statistics...</p>
                    </div>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">üë• Users Management</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Manage and monitor platform users</p>
                </div>

                <div class="content-box">
                    <h2>Recent Users</h2>
                    <div id="usersTable">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading users...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Community Stories Section -->
            <section id="community-stories-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">üåü Community Stories</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Review and manage story submissions</p>
                </div>

                <!-- Screenshot Upload Section -->
                <div class="content-box">
                    <h3 style="color: #6366f1; margin-bottom: 1rem;">üì∏ Upload User Tweet Screenshots</h3>
                    <p style="font-size: 0.9rem; color: rgba(241, 245, 249, 0.7); margin-bottom: 1rem;">
                        Upload screenshot images directly. They will be automatically uploaded to ImgBB and saved to the database.
                    </p>

                    <form id="uploadScreenshotForm" enctype="multipart/form-data">
                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">Select Image File:</label>
                            <input type="file" id="screenshotFile" name="image" accept="image/*" class="form-control" required>
                            <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.25rem;">
                                Supported formats: PNG, JPG, JPEG, GIF, BMP, WEBP
                            </small>
                        </div>

                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">User Wallet Address (Optional):</label>
                            <input type="text" id="screenshotWallet" name="wallet_address" placeholder="0x..." class="form-control">
                        </div>

                        <!-- Image Preview -->
                        <div id="imagePreview" style="margin-bottom: 1rem; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px; min-height: 100px; display: flex; align-items: center; justify-content: center;">
                            <small style="color: rgba(241, 245, 249, 0.5);">Image preview will appear here</small>
                        </div>

                        <button type="submit" class="btn btn-primary" style="padding: 0.75rem 1.2rem; font-size: 1rem; width: 100%;">
                            üì§ Upload Screenshot
                        </button>
                    </form>

                    <div id="uploadStatusMessage" style="margin-top: 1rem; padding: 0.75rem; border-radius: 8px; display: none;"></div>
                </div>

                <!-- NEW: Requirement Image Upload Section -->
                <div class="content-box">
                    <h3 style="color: #10b981; margin-bottom: 1rem;">üåü Upload Requirement Example Images</h3>
                    <p style="font-size: 0.9rem; color: rgba(241, 245, 249, 0.7); margin-bottom: 1rem;">
                        Upload images to be used as examples for community story requirements.
                    </p>

                    <form id="uploadRequirementImageForm" enctype="multipart/form-data">
                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">Select Requirement Image File:</label>
                            <input type="file" id="requirementImageFile" name="image" accept="image/*" class="form-control" required>
                            <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.25rem;">
                                Supported formats: PNG, JPG, JPEG, GIF, BMP, WEBP
                            </small>
                        </div>

                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">Image Title (Optional):</label>
                            <input type="text" id="requirementImageTitle" name="title" placeholder="e.g., Example Screenshot" class="form-control">
                        </div>

                        <!-- Requirement Image Preview -->
                        <div id="requirementImagePreview" style="margin-bottom: 1rem; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px; min-height: 100px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                            <small style="color: rgba(241, 245, 249, 0.5);">üì∑ Requirement image preview will appear here</small>
                        </div>

                        <button type="submit" class="btn btn-primary" style="padding: 0.75rem 1.2rem; font-size: 1rem; width: 100%;">
                            ‚¨ÜÔ∏è Upload Requirement Image
                        </button>
                    </form>

                    <div id="requirementImageStatusMessage" style="margin-top: 1rem; padding: 0.75rem; border-radius: 8px; display: none;"></div>

                    <!-- Display recent requirement images -->
                    <div id="recentRequirementImages" style="margin-top: 2rem; display: none;">
                        <h3 style="color: #10b981; margin-bottom: 1rem;">üñºÔ∏è Recently Uploaded Requirement Images</h3>
                        <div id="recentRequirementImagesList" style="display: flex; gap: 1rem; overflow-x: auto; padding-bottom: 1rem;">
                            <!-- Images will be loaded here by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Pending Submissions -->
                <div class="content-box">
                    <h3 style="color: #fbbf24; margin-bottom: 0.5rem;">‚è≥ Pending Submissions</h3>
                    <div id="communityStoriesNotifications">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading submissions...</p>
                        </div>
                    </div>
                </div>

                <!-- Action History -->
                <div class="content-box">
                    <h3 style="color: #10b981; margin-bottom: 0.5rem;">üìã Recent Actions</h3>
                    <div id="communityStoriesHistory">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading history...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Daily Tasks Management Section -->
            <section id="daily-tasks-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">‚úÖ Daily Tasks Management</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Approve or reject daily task submissions before disbursement</p>
                </div>

                <div class="content-box">
                    <h2 style="color: #fbbf24; margin-bottom: 1rem;">‚è≥ Pending Submissions</h2>
                    <div id="dailyTasksContent">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading pending tasks...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Learn & Earn Maintenance Mode Section -->
            <section id="maintenance-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">üîß Learn & Earn Maintenance</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Control Learn & Earn feature availability</p>
                </div>

                <div class="content-box">
                    <h2>Learn & Earn Maintenance</h2>

                    <div id="maintenance-status" style="margin-bottom: 2rem;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading maintenance status...</p>
                        </div>
                    </div>

                    <div id="maintenance-controls" style="display: none;">
                        <div style="margin-bottom: 2rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #f1f5f9;">Current Status</h3>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <span style="font-size: 1.1rem; font-weight: 600;">Learn & Earn:</span>
                                <span id="current-status-badge" style="padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600;"></span>
                            </div>
                            <div id="current-message-display" style="margin-top: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px; display: none;">
                                <strong>Current Message:</strong>
                                <p id="current-message-text" style="margin-top: 0.5rem; color: rgba(241, 245, 249, 0.8);"></p>
                            </div>
                        </div>

                        <div style="padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #f1f5f9;">Update Maintenance Mode</h3>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Status</label>
                                <select id="maintenance-mode" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem;">
                                    <option value="false">‚úÖ Active (Users can take quiz)</option>
                                    <option value="true">üîß Maintenance (Feature disabled)</option>
                                </select>
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Custom Message</label>
                                <textarea id="maintenance-message" rows="3" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem; resize: vertical;" placeholder="Enter custom message to show when maintenance is active..."></textarea>
                                <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                    This message will be shown to users when Learn & Earn is under maintenance.
                                </small>
                            </div>

                            <button class="btn btn-primary" onclick="updateMaintenanceMode()" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                                üíæ Update Maintenance Mode
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Minigames Maintenance Mode Section -->
            <section id="minigames-maintenance-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">üéÆ Minigames Maintenance</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Control Minigames feature availability</p>
                </div>

                <div class="content-box">
                    <h2>Minigames Maintenance</h2>

                    <div id="minigames-maintenance-status" style="margin-bottom: 2rem;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading maintenance status...</p>
                        </div>
                    </div>

                    <div id="minigames-maintenance-controls" style="display: none;">
                        <div style="margin-bottom: 2rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #f1f5f9;">Current Status</h3>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <span style="font-size: 1.1rem; font-weight: 600;">Minigames:</span>
                                <span id="minigames-current-status-badge" style="padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600;"></span>
                            </div>
                            <div id="minigames-current-message-display" style="margin-top: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px; display: none;">
                                <strong>Current Message:</strong>
                                <p id="minigames-current-message-text" style="margin-top: 0.5rem; color: rgba(241, 245, 249, 0.8);"></p>
                            </div>
                        </div>

                        <div style="padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #f1f5f9;">Update Maintenance Mode</h3>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Status</label>
                                <select id="minigames-maintenance-mode" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem;">
                                    <option value="false">‚úÖ Active (Users can play minigames)</option>
                                    <option value="true">üîß Maintenance (Feature disabled)</option>
                                </select>
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Custom Message</label>
                                <textarea id="minigames-maintenance-message" rows="3" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem; resize: vertical;" placeholder="Enter custom message to show when maintenance is active..."></textarea>
                                <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                    This message will be shown to users when Minigames is under maintenance.
                                </small>
                            </div>

                            <button class="btn btn-primary" onclick="updateMinigamesMaintenance()" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                                üíæ Update Maintenance Mode
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Community Stories Settings Section -->
            <section id="community-stories-settings-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">üåü Community Stories Settings</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Configure Community Stories rewards and participation window</p>
                </div>

                <div class="content-box">
                    <h2>Current Settings</h2>

                    <div id="community-stories-settings-status" style="margin-bottom: 2rem;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading settings...</p>
                        </div>
                    </div>

                    <div id="community-stories-settings-controls" style="display: none;">
                        <div style="margin-bottom: 2rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #f1f5f9;">Current Configuration</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div style="padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                                    <strong>Text Post Reward:</strong>
                                    <p id="current-low-reward" style="font-size: 1.5rem; color: #6366f1; margin-top: 0.5rem;">2,000 G$</p>
                                </div>
                                <div style="padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                                    <strong>Video Post Reward:</strong>
                                    <p id="current-high-reward" style="font-size: 1.5rem; color: #10b981; margin-top: 0.5rem;">5,000 G$</p>
                                </div>
                                <div style="padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                                    <strong>Window Start:</strong>
                                    <p id="current-window-start" style="font-size: 1.5rem; color: #ef4444; margin-top: 0.5rem;">26th</p>
                                </div>
                                <div style="padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                                    <strong>Window End:</strong>
                                    <p id="current-window-end" style="font-size: 1.5rem; color: #fbbf24; margin-top: 0.5rem;">30th</p>
                                </div>
                            </div>
                            <div style="margin-top: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                                <strong>Required Mentions:</strong>
                                <p id="current-mentions" style="margin-top: 0.5rem; color: rgba(241, 245, 249, 0.8);"></p>
                            </div>
                        </div>

                        <div style="padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #f1f5f9;">Update Settings</h3>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Text Post Reward (G$)</label>
                                <input type="number" id="low-reward" min="100" max="10000" step="100" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem;">
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Video Post Reward (min. 30s) (G$)</label>
                                <input type="number" id="high-reward" min="100" max="10000" step="100" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem;">
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Required Mentions/Hashtags</label>
                                <input type="text" id="required-mentions" placeholder="@gooddollarorg @GoodDollarTeam" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem;">
                                <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                    Separate multiple mentions with spaces
                                </small>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Window Start Day (1-31)</label>
                                    <input type="number" id="window-start-day" min="1" max="31" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Window End Day (1-31)</label>
                                    <input type="number" id="window-end-day" min="1" max="31" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem;">
                                </div>
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Community Stories Message</label>
                                <textarea id="community-stories-message" rows="10" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem; resize: vertical; font-family: 'Inter', sans-serif;" placeholder="Enter the message that will be shown on the Community Stories page..."></textarea>
                                <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                    This message will be displayed on the Community Stories asking page. Use emojis and line breaks to format.
                                </small>
                            </div>

                            <button class="btn btn-primary" onclick="updateCommunityStoriesSettings()" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                                üíæ Update Community Stories Settings
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Insufficient Balance Message Section -->
            <section id="insufficient-balance-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">üí∞ Insufficient Balance Message</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Customize the message shown when Learn & Earn wallet has insufficient funds</p>
                </div>

                <div class="content-box">
                    <h2>Customize Error Message</h2>

                    <div id="insufficient-balance-status" style="margin-bottom: 2rem;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading current message...</p>
                        </div>
                    </div>

                    <div id="insufficient-balance-controls" style="display: none;">
                        <div style="margin-bottom: 2rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #f1f5f9;">Current Message</h3>
                            <div id="current-insufficient-message-display" style="padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                                <p id="current-insufficient-message-text" style="color: rgba(241, 245, 249, 0.8);"></p>
                            </div>
                        </div>

                        <div style="padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #f1f5f9;">Update Error Message</h3>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Error Message</label>
                                <textarea id="insufficient-balance-message" rows="4" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem; resize: vertical;" placeholder="Enter the message to show when wallet funds are depleted..."></textarea>
                                <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                    This message will be shown to users when the Learn & Earn disbursement wallet has insufficient balance.
                                </small>
                            </div>

                            <button class="btn btn-primary" onclick="updateInsufficientBalanceMessage()" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                                üíæ Update Error Message
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quiz Settings Section -->
            <section id="quiz-settings-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">‚öôÔ∏è Quiz Settings</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Configure Learn & Earn quiz parameters</p>
                </div>

                <div class="content-box">
                    <h2>Current Quiz Configuration</h2>

                    <div id="quiz-settings-status" style="margin-bottom: 2rem;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading quiz settings...</p>
                        </div>
                    </div>

                    <div id="quiz-settings-controls" style="display: none;">
                        <div style="margin-bottom: 2rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #f1f5f9;">Current Settings</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div style="padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                                    <strong>Questions per Quiz:</strong>
                                    <p id="current-questions" style="font-size: 1.5rem; color: #6366f1; margin-top: 0.5rem;">10</p>
                                </div>
                                <div style="padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                                    <strong>Time per Question:</strong>
                                    <p id="current-time" style="font-size: 1.5rem; color: #10b981; margin-top: 0.5rem;">20s</p>
                                </div>
                                <div style="padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                                    <strong>Max Reward:</strong>
                                    <p id="current-max-reward" style="font-size: 1.5rem; color: #ef4444; margin-top: 0.5rem;">2000 G$</p>
                                </div>
                                <div style="padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                                    <strong>Per Correct Answer:</strong>
                                    <p id="current-per-correct" style="font-size: 1.5rem; color: #fbbf24; margin-top: 0.5rem;">200 G$</p>
                                </div>
                            </div>
                        </div>

                        <div style="padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #f1f5f9;">Update Quiz Settings</h3>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Questions per Quiz (5-30)</label>
                                <input type="number" id="questions-per-quiz" min="5" max="30" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem;">
                                <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                    Reward per correct answer will be automatically calculated (Max Reward √∑ Questions)
                                </small>
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Time per Question (10-60 seconds)</label>
                                <input type="number" id="time-per-question" min="10" max="60" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem;">
                            </div>

                            <div style="margin-bottom: 1.5rem;">
                                <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Maximum Reward (500-10,000 G$)</label>
                                <input type="number" id="max-reward-per-quiz" min="500" max="10000" step="100" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem;">
                                <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                    Total reward for a perfect quiz score
                                </small>
                            </div>

                            <button class="btn btn-primary" onclick="updateQuizSettings()" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                                üíæ Update Quiz Settings
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Broadcast Messages Section -->
            <section id="broadcast-messages-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">üì¢ Broadcast Messages</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Send instant notifications to all users with voice message support</p>
                </div>

                <div class="content-box">
                    <h2>Send New Broadcast Message</h2>

                    <div style="padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px; margin-bottom: 2rem;">
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Message Title</label>
                            <input type="text" id="broadcast-title" placeholder="Enter message title..." style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem;" onkeyup="updateBroadcastPreview()">
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9); font-weight: 600;">Message Content</label>
                            <textarea id="broadcast-message" rows="5" placeholder="Enter your message here..." style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 1rem; resize: vertical;" onkeyup="updateBroadcastPreview()"></textarea>
                            <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                ‚ú® This message will instantly appear in ALL users' inbox with voice message support. Use emojis for better engagement.
                            </small>
                        </div>

                        <div style="margin-bottom: 1.5rem; padding: 1rem; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem; color: #fbbf24;">üìã Preview:</div>
                            <div id="broadcast-preview" style="color: rgba(241, 245, 249, 0.8); font-size: 0.9rem; line-height: 1.5;">
                                <div id="preview-title" style="font-weight: 700; margin-bottom: 0.5rem;">Message Title</div>
                                <div id="preview-message">Your message will appear here...</div>
                            </div>
                            <button onclick="testVoiceMessage()" class="btn btn-secondary" style="margin-top: 1rem; width: 100%;">
                                üîä Test Voice Message
                            </button>
                        </div>

                        <button class="btn btn-primary" onclick="sendBroadcastMessage()" style="width: 100%; padding: 1rem; font-size: 1.1rem; background: linear-gradient(135deg, #ef4444, #dc2626);">
                            üì¢ Send to All Users with Voice Notification
                        </button>
                    </div>
                </div>

                <div class="content-box">
                    <h2>Broadcast History</h2>
                    <div id="broadcastMessagesTable">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading broadcast messages...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- News Management Section -->
            <section id="news-management-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">üì∞ News Management</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Publish and manage news articles</p>
                </div>

                <!-- News History Section -->
                <div class="content-box">
                    <h2>üìã News Posts History</h2>
                    <div id="newsHistoryTable">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading news history...</p>
                        </div>
                    </div>
                </div>

                <div class="content-box">
                    <h2>üìù Publish New News Article</h2>

                    <form id="newsForm" enctype="multipart/form-data" style="padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label">Article Title</label>
                            <input type="text" id="newsTitle" class="form-control" placeholder="Enter news title..." required>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label">Content</label>
                            <textarea id="newsContent" rows="6" class="form-control" placeholder="Enter news content... (URLs will be automatically clickable)" required></textarea>
                            <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                üí° Tip: Include links (https://...) in your content - they will be automatically clickable for users
                            </small>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                            <div>
                                <label class="form-label">Category</label>
                                <select id="newsCategory" class="form-control">
                                    <option value="announcement">üì¢ Announcement</option>
                                    <option value="update">üîÑ Platform Update</option>
                                    <option value="community">üë• Community</option>
                                    <option value="blockchain">‚õìÔ∏è Blockchain</option>
                                    <option value="reward">üí∞ Rewards</option>
                                    <option value="feature">‚ú® New Feature</option>
                                    <option value="maintenance">üîß Maintenance</option>
                                    <option value="partnership">ü§ù Partnership</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Priority</label>
                                <select id="newsPriority" class="form-control">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label">
                                <input type="checkbox" id="newsFeatured" style="margin-right: 0.5rem;">
                                Feature this article (show prominently)
                            </label>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label">External Link URL (Optional)</label>
                            <input type="url" id="newsUrl" placeholder="https://example.com" class="form-control">
                            <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                Add an external link that opens when clicking "Read More"
                            </small>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label">Upload Image (Optional)</label>
                            <input type="file" id="newsImage" accept="image/*" class="form-control">
                            <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                Supported: PNG, JPG, JPEG, GIF, WEBP
                            </small>
                        </div>

                        <div id="newsImagePreview" style="margin-bottom: 1.5rem; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px; min-height: 100px; display: none; align-items: center; justify-content: center;">
                            <img id="newsImagePreviewImg" style="max-width: 100%; max-height: 300px; border-radius: 8px;">
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                            üì∞ Publish News Article
                        </button>
                    </form>

                    <div id="newsStatusMessage" style="margin-top: 1rem; padding: 0.75rem; border-radius: 8px; display: none;"></div>
                </div>
            </section>

            <!-- Quiz Section -->
            <section id="quiz-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">üìö Quiz Questions</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Manage quiz questions database</p>
                </div>

                <div class="content-box">
                    <div style="margin-bottom: 1rem; padding: 0.5rem; background: rgba(99, 102, 241, 0.1); border-radius: 8px; font-size: 0.9rem;">
                        <strong>Data Source:</strong> Supabase 'quiz_questions' table
                    </div>

                    <!-- DIRECT TEXT INPUT FOR BULK QUESTIONS -->
                    <div style="margin-bottom: 2rem; padding: 1.5rem; background: rgba(16, 185, 129, 0.1); border-radius: 12px; border: 2px solid rgba(16, 185, 129, 0.3);">
                        <h3 style="margin-bottom: 1rem; color: #10b981;">üìù Paste Questions Directly (Recommended)</h3>
                        <p style="margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.8); font-size: 0.9rem;">
                            Copy all your questions in the format below and paste here. Click "Add All Questions" to automatically parse and save them.
                        </p>
                        <div style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(99, 102, 241, 0.1); border-radius: 8px; border-left: 3px solid #6366f1;">
                            <strong style="color: #a5b4fc;">‚úì Format Requirements:</strong>
                            <ul style="margin: 0.5rem 0 0 1.5rem; color: rgba(241, 245, 249, 0.7); font-size: 0.85rem;">
                                <li>Each question must have: QUESTION_ID, QUESTION, A, B, C, D, CORRECT</li>
                                <li>Separate questions with a blank line</li>
                                <li>CORRECT must be A, B, C, or D</li>
                                <li>Field labels are case-insensitive</li>
                            </ul>
                        </div>

                        <textarea id="bulkQuestionsInput" rows="15" placeholder="QUESTION_ID: Q001
QUESTION: What is GoodDollar?
A: A cryptocurrency for UBI
B: A bank
C: A credit card
D: A website
CORRECT: A

QUESTION_ID: Q002
QUESTION: How often can you claim?
A: Monthly
B: Daily
C: Yearly
D: Once
CORRECT: B

QUESTION_ID: Q003
QUESTION: What blockchain does GoodDollar use?
A: Bitcoin
B: Ethereum
C: Celo
D: Binance Smart Chain
CORRECT: C

(Paste all questions here - separate each with a blank line)" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9; font-size: 0.9rem; resize: vertical; font-family: 'Courier New', monospace;"></textarea>

                        <button class="btn btn-primary" onclick="parseBulkQuestions()" style="width: 100%; margin-top: 1rem; padding: 1rem; font-size: 1.1rem; background: linear-gradient(135deg, #10b981, #059669);">
                            ‚úÖ Add All Questions from Text
                        </button>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showAddQuestionModal()">
                            ‚ûï Add Single Question
                        </button>
                        <button class="btn btn-danger" onclick="deleteAllQuestions()" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                            üóëÔ∏è Delete All Questions
                        </button>
                    </div>
                    <div id="questionsTable">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading questions from Supabase...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Developer Profile Section -->
            <section id="developer-profile-section" class="section">
                <div class="page-header">
                    <h1 class="page-title">üë®‚Äçüíª Developer Profile</h1>
                    <p style="color: rgba(241, 245, 249, 0.7);">Upload or update the developer profile displayed on the homepage</p>
                </div>

                <div class="content-box">
                    <h2>Upload Developer Profile</h2>

                    <div style="padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label">Developer Name</label>
                            <input type="text" id="developerName" placeholder="Enter developer name" class="form-control">
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label">Position/Title</label>
                            <input type="text" id="developerPosition" placeholder="e.g., Community Moderator of GoodDollar and Developer of GoodMarket" class="form-control">
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label">Profile Image (recommended: 200x200px, max 5MB)</label>
                            <input type="file" id="developerImageFile" accept="image/*" class="form-control">
                            <small style="color: rgba(241, 245, 249, 0.6); display: block; margin-top: 0.5rem;">
                                Supported formats: JPG, PNG, GIF
                            </small>
                        </div>

                        <button onclick="uploadDeveloperProfile()" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                            üì§ Upload Profile
                        </button>
                    </div>

                    <div id="developerProfileStatus" style="margin-top: 1rem; padding: 0.75rem; border-radius: 8px; display: none;"></div>

                    <!-- Current Profile Display -->
                    <div id="currentProfile" style="margin-top: 2rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px; display: none;">
                        <h3 style="margin-bottom: 1rem; color: #f1f5f9;">Current Profile:</h3>
                        <div style="display: flex; align-items: center; gap: 1.5rem;">
                            <img id="currentProfileImage" src="" alt="Profile" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid #6366f1;">
                            <div>
                                <div id="currentProfileName" style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.25rem; color: #f1f5f9;"></div>
                                <div id="currentProfilePosition" style="color: rgba(241, 245, 249, 0.7);"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            

            <!-- Add Question Modal -->
            <div id="questionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto;">
                <div style="max-width: 600px; margin: 50px auto; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 2rem; border-radius: 16px; border: 1px solid rgba(239, 68, 68, 0.2);">
                    <h2 id="modalTitle" style="margin-bottom: 1.5rem;">Add New Question</h2>
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9);">Question ID</label>
                        <input type="text" id="questionId" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9;" placeholder="Q001">
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9);">Question</label>
                        <textarea id="questionText" rows="3" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9;" placeholder="What is...?"></textarea>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9);">Answer A</label>
                        <input type="text" id="answerA" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9;">
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9);">Answer B</label>
                        <input type="text" id="answerB" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9;">
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9);">Answer C</label>
                        <input type="text" id="answerC" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9;">
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9);">Answer D</label>
                        <input type="text" id="answerD" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9;">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; color: rgba(241, 245, 249, 0.9);">Correct Answer</label>
                        <select id="correctAnswer" style="width: 100%; padding: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f1f5f9;">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary" onclick="saveQuestion()" style="flex: 1;">Save Question</button>
                        <button class="btn btn-danger" onclick="closeQuestionModal()" style="flex: 1;">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Module Links Section (NEW) -->
            <div class="admin-section" id="module-links-section" style="display: none;">
                <h2>üîó Module Links</h2>
                <p>Manage the module links for the Learn & Earn section.</p>

                <div class="content-box">
                    <h2>Add New Module Link</h2>

                    <form id="addModuleLinkForm" style="margin-bottom: 1.5rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">Link Title</label>
                            <input type="text" id="newModuleLinkTitle" placeholder="e.g., Introduction to Blockchain" class="admin-input" style="margin-bottom: 0;" required>
                        </div>

                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">URL (optional)</label>
                            <input type="text" id="newModuleLinkUrl" placeholder="Module Link URL (optional)" class="admin-input" style="margin-bottom: 0;">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">Description (optional)</label>
                            <textarea id="newModuleLinkDescription" placeholder="Description (optional)" class="admin-input" rows="2" style="margin-bottom: 0;"></textarea>
                        </div>

                        <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(34, 197, 94, 0.15); border-radius: 8px; border-left: 3px solid #22c55e;">
                            <div style="color: #86efac; font-weight: 700; margin-top: 10px; margin-bottom: 0.5rem; font-size: 1.1rem;">
                                ü§ñ AUTO-SCRAPING ENABLED
                            </div>
                            <small style="display: block; color: rgba(241, 245, 249, 0.7); line-height: 1.6;">
                                ‚ú® Just paste a URL above and leave "Content" empty<br>
                                üì• System will automatically fetch and format the content<br>
                                ‚è∞ Reading time will be calculated automatically<br>
                                üíæ No manual copy-paste needed!
                            </small>
                        </div>

                        <label style="color: #667eea; font-weight: bold; margin-top: 10px; display: block;">Module Content (Optional - leave empty to auto-scrape from URL):</label>
                        <textarea id="newModuleLinkContent" placeholder="‚ú® LEAVE EMPTY to auto-scrape content from URL above ‚ú®

OR manually enter HTML content here...
(Supported tags: <h2>, <h3>, <p>, <ul>, <ol>, <li>, <strong>, <em>)" class="admin-input" rows="10" style="font-family: monospace;"></textarea>

                        <label style="color: #667eea; font-weight: bold; margin-top: 10px; display: block;">Reading Time (minutes):</label>
                        <input type="number" id="newModuleLinkReadingTime" placeholder="5" class="admin-input" value="5" min="1" max="60">

                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">Display Order</label>
                            <input type="number" id="newModuleLinkOrder" placeholder="Display Order" class="admin-input" style="margin-bottom: 0;" value="1" min="1">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                            ‚ûï Add Module Link
                        </button>
                    </form>
                </div>

                <div class="content-box">
                    <h2>Current Module Links</h2>
                    <div id="moduleLinksTable">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading module links...</p>
                        </div>
                    </div>
                </div>

                <div id="editModuleLinkModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; overflow-y: auto;">
                    <div style="max-width: 600px; margin: 2rem auto; padding: 2rem; background: #1e293b; border-radius: 16px; border: 1px solid rgba(99, 102, 241, 0.3);">
                        <h2 style="margin-bottom: 1.5rem; color: #f1f5f9;">‚úèÔ∏è Edit Module Link</h2>
                        <input type="hidden" id="editModuleLinkId">
                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">Title</label>
                            <input type="text" id="editModuleLinkTitle" class="admin-input" style="margin-bottom: 0;" required>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">URL (optional)</label>
                            <input type="text" id="editModuleLinkUrl" class="admin-input" style="margin-bottom: 0;">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">Description (optional)</label>
                            <textarea id="editModuleLinkDescription" class="admin-input" rows="2" style="margin-bottom: 0;"></textarea>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">Content</label>
                            <textarea id="editModuleLinkContent" class="admin-input" rows="10" style="margin-bottom: 0; font-family: monospace;"></textarea>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">Reading Time (minutes)</label>
                            <input type="number" id="editModuleLinkReadingTime" class="admin-input" style="margin-bottom: 0;" min="1" max="60">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label class="form-label">Display Order</label>
                            <input type="number" id="editModuleLinkOrder" class="admin-input" style="margin-bottom: 0;" min="1">
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label">Status</label>
                            <select id="editModuleLinkActive" class="admin-input" style="margin-bottom: 0;">
                                <option value="true">Active</option>
                                <option value="false">Inactive</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn btn-primary" onclick="updateModuleLink()" style="flex: 1; padding: 0.75rem;">üíæ Save Changes</button>
                            <button class="btn btn-danger" onclick="closeEditModuleLinkModal()" style="flex: 1; padding: 0.75rem;">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reward Configuration Section (NEW) -->
            <div class="admin-section" id="reward-config-section" style="display: none;">
                <h2>üí∞ Reward Configuration</h2>
                <p>Manage reward amounts for social media tasks.</p>

                <div class="content-box">
                    <h2>Task Rewards</h2>
                    <div id="reward-config-status" style="margin-bottom: 2rem;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading reward configuration...</p>
                        </div>
                    </div>

                    <div id="reward-config-controls" style="display: none;">
                        <!-- Telegram Task Reward -->
                        <div style="margin-bottom: 2rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #00acee;">
                                <span class="menu-icon">üì±</span> Telegram Task Reward
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                <div>
                                    <strong>Current Reward:</strong>
                                    <p id="current-telegram-reward" style="font-size: 1.5rem; color: #10b981; margin-top: 0.5rem;">Loading...</p>
                                    <small id="telegram-last-updated" class="text-muted"></small>
                                </div>
                                <div>
                                    <label class="form-label">New Reward Amount (G$)</label>
                                    <input type="number" id="telegram-reward-input" min="10" max="10000" step="10" class="form-control" placeholder="100">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="updateRewardConfig('telegram_task')" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                                üíæ Update Telegram Reward
                            </button>
                        </div>

                        <!-- Twitter Task Reward -->
                        <div style="margin-bottom: 2rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #1DA1F2;">
                                <span class="menu-icon">üê¶</span> Twitter Task Reward
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                <div>
                                    <strong>Current Reward:</strong>
                                    <p id="current-twitter-reward" style="font-size: 1.5rem; color: #10b981; margin-top: 0.5rem;">Loading...</p>
                                    <small id="twitter-last-updated" class="text-muted"></small>
                                </div>
                                <div>
                                    <label class="form-label">New Reward Amount (G$)</label>
                                    <input type="number" id="twitter-reward-input" min="10" max="10000" step="10" class="form-control" placeholder="100">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="updateRewardConfig('twitter_task')" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                                üíæ Update Twitter Reward
                            </button>
                        </div>

                        <!-- Facebook Task Reward -->
                        <div style="margin-bottom: 2rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
                            <h3 style="margin-bottom: 1rem; color: #1877F2;">
                                <span class="menu-icon">üìò</span> Facebook Task Reward
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                <div>
                                    <strong>Current Reward:</strong>
                                    <p id="current-facebook-reward" style="font-size: 1.5rem; color: #10b981; margin-top: 0.5rem;">Loading...</p>
                                    <small id="facebook-last-updated" class="text-muted"></small>
                                </div>
                                <div>
                                    <label class="form-label">New Reward Amount (G$)</label>
                                    <input type="number" id="facebook-reward-input" min="10" max="10000" step="10" class="form-control" placeholder="100">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="updateRewardConfig('facebook_task')" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                                üíæ Update Facebook Reward
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Load admin statistics on page load
        async function loadAdminStats() {
            try {
                const response = await fetch('/api/admin/stats');
                const data = await response.json();
                
                if (data.success && data.stats) {
                    const statsGrid = document.getElementById('statsGrid');
                    statsGrid.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-label">Total Users</div>
                            <div class="stat-value">${data.stats.total_users || 0}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Verified Users</div>
                            <div class="stat-value">${data.stats.verified_users || 0}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total Page Views</div>
                            <div class="stat-value">${data.stats.total_page_views || 0}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Verification Rate</div>
                            <div class="stat-value">${data.stats.verification_rate || '0%'}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('‚ùå Error loading stats:', error);
                document.getElementById('statsGrid').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #ef4444;">
                        Error loading statistics
                    </div>
                `;
            }
        }

        // Load developer profile function
        async function uploadDeveloperProfile() {
            const name = document.getElementById('developerName').value.trim();
            const position = document.getElementById('developerPosition').value.trim();
            const imageFile = document.getElementById('developerImageFile').files[0];
            const statusDiv = document.getElementById('developerProfileStatus');

            if (!name || !position) {
                statusDiv.className = 'status-message error';
                statusDiv.style.display = 'block';
                statusDiv.textContent = '‚ùå Name and position are required';
                return;
            }

            if (!imageFile) {
                statusDiv.className = 'status-message error';
                statusDiv.style.display = 'block';
                statusDiv.textContent = '‚ùå Profile image is required';
                return;
            }

            const formData = new FormData();
            formData.append('name', name);
            formData.append('position', position);
            formData.append('image', imageFile);

            statusDiv.className = 'status-message';
            statusDiv.style.display = 'block';
            statusDiv.style.backgroundColor = 'rgba(251, 191, 36, 0.15)';
            statusDiv.style.color = '#fbbf24';
            statusDiv.textContent = '‚è≥ Uploading profile...';

            try {
                const response = await fetch('/api/admin/developer-profile', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    statusDiv.className = 'status-message success';
                    statusDiv.textContent = '‚úÖ ' + data.message;
                    
                    // Clear form
                    document.getElementById('developerName').value = '';
                    document.getElementById('developerPosition').value = '';
                    document.getElementById('developerImageFile').value = '';
                    
                    // Show current profile if available
                    if (data.profile) {
                        showCurrentProfile(data.profile);
                    }
                } else {
                    statusDiv.className = 'status-message error';
                    statusDiv.textContent = '‚ùå ' + data.error;
                }
            } catch (error) {
                statusDiv.className = 'status-message error';
                statusDiv.textContent = '‚ùå Upload failed: ' + error.message;
            }
        }

        function showCurrentProfile(profile) {
            const currentProfileDiv = document.getElementById('currentProfile');
            document.getElementById('currentProfileName').textContent = profile.name;
            document.getElementById('currentProfilePosition').textContent = profile.position;
            document.getElementById('currentProfileImage').src = profile.image_url;
            currentProfileDiv.style.display = 'block';
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadAdminStats();
        });

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active from all menu links
            document.querySelectorAll('.menu-link').forEach(link => {
                link.classList.remove('active');
            });

            // Show the selected section
            const sectionToShow = document.getElementById(sectionId);
            if (sectionToShow) {
                sectionToShow.classList.add('active');
            }

            document.querySelectorAll('.admin-section').forEach(section => {
                section.style.display = 'none';
            });

            if (sectionToShow && sectionToShow.classList.contains('admin-section')) {
                sectionToShow.style.display = 'block';
            }

            const matchingMenuLink = document.querySelector(`.menu-link[onclick*="'${sectionId}'"]`);
            if (matchingMenuLink) {
                matchingMenuLink.classList.add('active');
            }

            // Load data specific to the section
            const sectionName = sectionId.replace('-section', '');
            loadSectionData(sectionName);
        }

        function loadSectionData(sectionName) {
            switch(sectionName) {
                case 'overview':
                    loadAdminStats();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'community-stories':
                    loadCommunityStoriesNotifications();
                    loadCommunityStoriesHistory();
                    loadRecentRequirementImages();
                    break;
                case 'daily-tasks':
                    loadPendingDailyTasks();
                    break;
                case 'quiz':
                    loadQuestions();
                    break;
                case 'maintenance':
                    loadMaintenanceStatus();
                    break;
                case 'minigames-maintenance':
                    loadMinigamesMaintenance();
                    break;
                case 'quiz-settings':
                    loadQuizSettings();
                    break;
                case 'community-stories-settings':
                    loadCommunityStoriesSettings();
                    break;
                case 'insufficient-balance':
                    loadInsufficientBalanceMessage();
                    break;
                case 'broadcast-messages':
                    loadBroadcastMessages();
                    break;
                case 'news-management':
                    loadNewsHistory();
                    break;
                case 'module-links':
                    loadModuleLinks();
                    break;
                case 'reward-config':
                    loadRewardConfig();
                    break;
                case 'developerProfile':
                    loadCurrentProfile();
                    break;
            }
        }

        async function loadQuizSettings() {
            try {
                const response = await fetch('/api/admin/quiz-settings');
                const data = await response.json();

                const statusDiv = document.getElementById('quiz-settings-status');
                const controlsDiv = document.getElementById('quiz-settings-controls');

                if (data.success) {
                    const settings = data.settings;

                    document.getElementById('current-questions').textContent = settings.questions_per_quiz;
                    document.getElementById('current-time').textContent = settings.time_per_question + 's';
                    document.getElementById('current-max-reward').textContent = settings.max_reward_per_quiz + ' G$';
                    document.getElementById('current-per-correct').textContent = Math.round(settings.reward_per_correct) + ' G$';

                    document.getElementById('questions-per-quiz').value = settings.questions_per_quiz;
                    document.getElementById('time-per-question').value = settings.time_per_question;
                    document.getElementById('max-reward-per-quiz').value = settings.max_reward_per_quiz;

                    statusDiv.style.display = 'none';
                    controlsDiv.style.display = 'block';
                } else {
                    statusDiv.innerHTML = '<p style="color: #ef4444;">Error loading quiz settings</p>';
                }
            } catch (error) {
                console.error('Error loading quiz settings:', error);
                document.getElementById('quiz-settings-status').innerHTML = '<p style="color: #ef4444;">Error loading quiz settings</p>';
            }
        }

        async function updateQuizSettings() {
            try {
                const questionsPerQuiz = parseInt(document.getElementById('questions-per-quiz').value);
                const timePerQuestion = parseInt(document.getElementById('time-per-question').value);
                const maxRewardPerQuiz = parseInt(document.getElementById('max-reward-per-quiz').value);

                if (!questionsPerQuiz || !timePerQuestion || !maxRewardPerQuiz) {
                    alert('‚ö†Ô∏è Please fill in all fields');
                    return;
                }

                const response = await fetch('/api/admin/quiz-settings', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        questions_per_quiz: questionsPerQuiz,
                        time_per_question: timePerQuestion,
                        max_reward_per_quiz: maxRewardPerQuiz
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const rewardPerCorrect = Math.round(maxRewardPerQuiz / questionsPerQuiz);
                    alert(`‚úÖ Quiz settings updated successfully!\n\n` +
                          `üìö Questions: ${questionsPerQuiz}\n` +
                          `‚è±Ô∏è Time: ${timePerQuestion}s per question\n` +
                          `üí∞ Max Reward: ${maxRewardPerQuiz} G$\n` +
                          `üíé Per Correct: ${rewardPerCorrect} G$`);
                    await loadQuizSettings();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error updating quiz settings:', error);
                alert('‚ùå Error updating quiz settings: ' + error.message);
            }
        }

        async function loadMaintenanceStatus() {
            try {
                const response = await fetch('/api/admin/maintenance/learn-earn');
                const data = await response.json();

                const statusDiv = document.getElementById('maintenance-status');
                const controlsDiv = document.getElementById('maintenance-controls');

                if (data.success) {
                    const isMaintenance = data.is_maintenance;
                    const message = data.message || '';

                    const badge = document.getElementById('current-status-badge');
                    if (isMaintenance) {
                        badge.textContent = 'üîß Maintenance Mode';
                        badge.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                        badge.style.color = 'white';
                    } else {
                        badge.textContent = '‚úÖ Active';
                        badge.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                        badge.style.color = 'white';
                    }

                    if (message) {
                        document.getElementById('current-message-display').style.display = 'block';
                        document.getElementById('current-message-text').textContent = message;
                    } else {
                        document.getElementById('current-message-display').style.display = 'none';
                    }

                    document.getElementById('maintenance-mode').value = isMaintenance.toString();
                    document.getElementById('maintenance-message').value = message;

                    statusDiv.style.display = 'none';
                    controlsDiv.style.display = 'block';
                } else {
                    statusDiv.innerHTML = '<p style="color: #ef4444;">Error loading maintenance status</p>';
                }
            } catch (error) {
                console.error('Error loading maintenance status:', error);
                document.getElementById('maintenance-status').innerHTML = '<p style="color: #ef4444;">Error loading maintenance status</p>';
            }
        }

        async function updateMaintenanceMode() {
            try {
                const isMaintenance = document.getElementById('maintenance-mode').value === 'true';
                const message = document.getElementById('maintenance-message').value.trim();

                if (isMaintenance && !message) {
                    alert('‚ö†Ô∏è Please enter a custom message for maintenance mode');
                    return;
                }

                const response = await fetch('/api/admin/maintenance/learn-earn', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        is_maintenance: isMaintenance,
                        message: message
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Maintenance mode ${isMaintenance ? 'enabled' : 'disabled'} successfully!`);
                    await loadMaintenanceStatus();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error updating maintenance mode:', error);
                alert('‚ùå Error updating maintenance mode: ' + error.message);
            }
        }

        async function loadMinigamesMaintenance() {
            try {
                const response = await fetch('/api/admin/maintenance/minigames');
                const data = await response.json();

                const statusDiv = document.getElementById('minigames-maintenance-status');
                const controlsDiv = document.getElementById('minigames-maintenance-controls');

                if (data.success) {
                    const isMaintenance = data.is_maintenance;
                    const message = data.message || '';

                    const badge = document.getElementById('minigames-current-status-badge');
                    if (isMaintenance) {
                        badge.textContent = 'üîß Maintenance Mode';
                        badge.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                        badge.style.color = 'white';
                    } else {
                        badge.textContent = '‚úÖ Active';
                        badge.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                        badge.style.color = 'white';
                    }

                    if (message) {
                        document.getElementById('minigames-current-message-display').style.display = 'block';
                        document.getElementById('minigames-current-message-text').textContent = message;
                    } else {
                        document.getElementById('minigames-current-message-display').style.display = 'none';
                    }

                    document.getElementById('minigames-maintenance-mode').value = isMaintenance.toString();
                    document.getElementById('minigames-maintenance-message').value = message;

                    statusDiv.style.display = 'none';
                    controlsDiv.style.display = 'block';
                } else {
                    statusDiv.innerHTML = '<p style="color: #ef4444;">Error loading maintenance status</p>';
                }
            } catch (error) {
                console.error('Error loading minigames maintenance status:', error);
                document.getElementById('minigames-maintenance-status').innerHTML = '<p style="color: #ef4444;">Error loading maintenance status</p>';
            }
        }

        async function updateMinigamesMaintenance() {
            try {
                const isMaintenance = document.getElementById('minigames-maintenance-mode').value === 'true';
                const message = document.getElementById('minigames-maintenance-message').value.trim();

                if (isMaintenance && !message) {
                    alert('‚ö†Ô∏è Please enter a custom message for maintenance mode');
                    return;
                }

                const response = await fetch('/api/admin/maintenance/minigames', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        is_maintenance: isMaintenance,
                        message: message
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Minigames maintenance mode ${isMaintenance ? 'enabled' : 'disabled'} successfully!`);
                    await loadMinigamesMaintenance();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error updating minigames maintenance mode:', error);
                alert('‚ùå Error updating minigames maintenance mode: ' + error.message);
            }
        }

        async function loadAdminStats() {
            try {
                const response = await fetch('/api/admin/stats');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('statsGrid').innerHTML = `
                        <div class="stat-card">
                            <div class="stat-label">Total Users</div>
                            <div class="stat-value">${stats.total_users || 0}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Verified Users</div>
                            <div class="stat-value">${stats.verified_users || 0}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total Page Views</div>
                            <div class="stat-value">${stats.total_page_views || 0}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Verification Rate</div>
                            <div class="stat-value">${stats.verification_rate || '0%'}</div>
                        </div>
                    `;
                } else {
                    document.getElementById('statsGrid').innerHTML = `<p style="color: #ef4444;">Error: ${data.error || 'Failed to load stats'}</p>`;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('statsGrid').innerHTML = `<p style="color: #ef4444;">Error: ${error.message}</p>`;
            }
        }

        let currentPage = 1;
        let totalUsers = 0;
        const usersPerPage = 50;

        async function loadUsers(page = 1) {
            try {
                currentPage = page;
                const offset = (page - 1) * usersPerPage;
                const response = await fetch(`/api/admin/users?limit=${usersPerPage}&offset=${offset}`);
                const data = await response.json();

                if (data.success && data.users.length > 0) {
                    const statsResponse = await fetch('/api/admin/stats');
                    const statsData = await statsResponse.json();
                    totalUsers = statsData.stats.total_users || 0;

                    const totalPages = Math.ceil(totalUsers / usersPerPage);

                    const usersHtml = `
                        <div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>Total Users: ${totalUsers}</strong> | 
                                Showing ${offset + 1}-${Math.min(offset + usersPerPage, totalUsers)}
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                ${page > 1 ? `<button class="btn btn-primary" onclick="loadUsers(${page - 1})">‚Üê Previous</button>` : ''}
                                <span style="padding: 0.5rem 1rem; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                    Page ${page} of ${totalPages}
                                </span>
                                ${page < totalPages ? `<button class="btn btn-primary" onclick="loadUsers(${page + 1})">Next ‚Üí</button>` : ''}
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Wallet Address</th>
                                    <th>UBI Verified</th>
                                    <th>Total Logins</th>
                                    <th>Last Login</th>
                                    <th>Created At</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.users.map(user => `
                                    <tr>
                                        <td style="font-family: monospace;">${user.wallet_address.substring(0,10)}...${user.wallet_address.substring(user.wallet_address.length - 8)}</td>
                                        <td>${user.ubi_verified ? '‚úÖ' : '‚ùå'}</td>
                                        <td>${user.total_logins || 0}</td>
                                        <td>${user.last_login ? new Date(user.last_login).toLocaleDateString() : 'N/A'}</td>
                                        <td>${user.created_at ? new Date(user.created_at).toLocaleDateString() : 'N/A'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('usersTable').innerHTML = usersHtml;
                } else {
                    document.getElementById('usersTable').innerHTML = '<p>No users found</p>';
                }
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('usersTable').innerHTML = '<p style="color: #ef4444;">Error loading users</p>';
            }
        }

        let currentEditingQuestionId = null;

        async function loadQuestions() {
            try {
                console.log('üìö Fetching questions from Supabase...');
                const response = await fetch('/api/admin/quiz-questions');
                const data = await response.json();

                console.log('‚úÖ Questions received:', data);

                if (data.success && data.questions.length > 0) {
                    const questionsHtml = `
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Question</th>
                                    <th>Correct</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.questions.map(q => `
                                    <tr>
                                        <td style="font-family: monospace;">${q.question_id}</td>
                                        <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${q.question}</td>
                                        <td>${q.correct}</td>
                                        <td>${q.created_at ? new Date(q.created_at).toLocaleDateString() : 'N/A'}</td>
                                        <td>
                                            <button class="btn btn-primary" onclick='editQuestion(${JSON.stringify(q).replace(/'/g, "&apos;")})' style="margin-right: 0.5rem; padding: 0.3rem 0.8rem; font-size: 0.9rem;">‚úèÔ∏è Edit</button>
                                            <button class="btn btn-danger" onclick="deleteQuestion('${q.question_id}')" style="padding: 0.3rem 0.8rem; font-size: 0.9rem;">üóëÔ∏è Delete</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('questionsTable').innerHTML = questionsHtml;
                } else {
                    document.getElementById('questionsTable').innerHTML = '<p>No questions found</p>';
                }
            } catch (error) {
                console.error('Error loading questions:', error);
                document.getElementById('questionsTable').innerHTML = '<p style="color: #ef4444;">Error loading questions</p>';
            }
        }

        function showAddQuestionModal() {
            currentEditingQuestionId = null;
            document.getElementById('modalTitle').textContent = 'Add New Question';
            document.getElementById('questionId').value = '';
            document.getElementById('questionId').disabled = false;
            document.getElementById('questionText').value = '';
            document.getElementById('answerA').value = '';
            document.getElementById('answerB').value = '';
            document.getElementById('answerC').value = '';
            document.getElementById('answerD').value = '';
            document.getElementById('correctAnswer').value = 'A';
            document.getElementById('questionModal').style.display = 'block';
        }

        function editQuestion(question) {
            currentEditingQuestionId = question.question_id;
            document.getElementById('modalTitle').textContent = 'Edit Question';
            document.getElementById('questionId').value = question.question_id;
            document.getElementById('questionId').disabled = true;
            document.getElementById('questionText').value = question.question;
            document.getElementById('answerA').value = question.answer_a;
            document.getElementById('answerB').value = question.answer_b;
            document.getElementById('answerC').value = question.answer_c;
            document.getElementById('answerD').value = question.answer_d;
            document.getElementById('correctAnswer').value = question.correct;
            document.getElementById('questionModal').style.display = 'block';
        }

        function closeQuestionModal() {
            document.getElementById('questionModal').style.display = 'none';
            currentEditingQuestionId = null;
        }

        async function saveQuestion() {
            const questionData = {
                question_id: document.getElementById('questionId').value.trim(),
                question: document.getElementById('questionText').value.trim(),
                answer_a: document.getElementById('answerA').value.trim(),
                answer_b: document.getElementById('answerB').value.trim(),
                answer_c: document.getElementById('answerC').value.trim(),
                answer_d: document.getElementById('answerD').value.trim(),
                correct: document.getElementById('correctAnswer').value
            };

            if (!questionData.question_id || !questionData.question || !questionData.answer_a || 
                !questionData.answer_b || !questionData.answer_c || !questionData.answer_d) {
                alert('Please fill in all fields');
                return;
            }

            try {
                let response;
                if (currentEditingQuestionId) {
                    const updateData = { ...questionData };
                    delete updateData.question_id;
                    response = await fetch(`/api/admin/quiz-questions/${currentEditingQuestionId}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(updateData)
                    });
                } else {
                    response = await fetch('/api/admin/quiz-questions', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(questionData)
                    });
                }

                const data = await response.json();

                if (data.success) {
                    const message = currentEditingQuestionId 
                        ? `‚úÖ Question ${currentEditingQuestionId} updated successfully!`
                        : '‚úÖ Question added successfully!';
                    alert(message);
                    closeQuestionModal();
                    await loadQuestions();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error saving question:', error);
                alert('Error saving question');
            }
        }

        async function deleteQuestion(questionId) {
            if (!confirm(`Are you sure you want to delete question ${questionId}?`)) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/quiz-questions/${questionId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Question ${questionId} deleted successfully!`);
                    await loadQuestions();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('‚ùå Error deleting question:', error);
                alert('‚ùå Error deleting question: ' + error.message);
            }
        }

        async function deleteAllQuestions() {
            const confirmation = confirm('‚ö†Ô∏è WARNING: Are you sure you want to delete ALL quiz questions?\n\nThis action cannot be undone!');

            if (!confirmation) {
                return;
            }

            const doubleConfirm = prompt('Type "DELETE ALL" to confirm:');

            if (doubleConfirm !== 'DELETE ALL') {
                alert('‚ùå Deletion cancelled - confirmation text did not match');
                return;
            }

            try {
                const questionsTable = document.getElementById('questionsTable');
                questionsTable.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Deleting all questions...</p>
                    </div>
                `;

                const response = await fetch('/api/admin/quiz-questions/delete-all', {
                    method: 'DELETE'
                });
                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Successfully deleted ${data.deleted_count} questions!`);
                    await loadQuestions();
                } else {
                    alert('‚ùå Error: ' + data.error);
                    await loadQuestions();
                }
            } catch (error) {
                console.error('‚ùå Error deleting all questions:', error);
                alert('‚ùå Error deleting all questions: ' + error.message);
                await loadQuestions();
            }
        }

        // News image preview
        document.addEventListener('DOMContentLoaded', function() {
            const newsImageInput = document.getElementById('newsImage');
            const newsImagePreview = document.getElementById('newsImagePreview');
            const newsImagePreviewImg = document.getElementById('newsImagePreviewImg');

            if (newsImageInput) {
                newsImageInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            newsImagePreviewImg.src = event.target.result;
                            newsImagePreview.style.display = 'flex';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        removeNewsImagePreview();
                    }
                });
            }

            const newsForm = document.getElementById('newsForm');
            if (newsForm) {
                newsForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await publishNewsArticle();
                });
            }
        });

        function removeNewsImagePreview() {
            document.getElementById('newsImagePreviewImg').src = '';
            document.getElementById('newsImagePreview').style.display = 'none';
        }

        function showNewsStatus(message, type) {
            const statusMessage = document.getElementById('newsStatusMessage');
            statusMessage.style.display = 'block';
            statusMessage.textContent = message;

            switch(type) {
                case 'loading':
                    statusMessage.style.background = 'rgba(99, 102, 241, 0.2)';
                    statusMessage.style.color = '#a5b4fc';
                    break;
                case 'success':
                    statusMessage.style.background = 'rgba(16, 185, 129, 0.2)';
                    statusMessage.style.color = '#6ee7b7';
                    break;
                case 'error':
                    statusMessage.style.background = 'rgba(239, 68, 68, 0.2)';
                    statusMessage.style.color = '#fca5a5';
                    break;
                case 'hidden':
                    statusMessage.style.display = 'none';
                    break;
            }
        }

        async function publishNewsArticle() {
            const title = document.getElementById('newsTitle').value.trim();
            const content = document.getElementById('newsContent').value.trim();
            const category = document.getElementById('newsCategory').value;
            const priority = document.getElementById('newsPriority').value;
            const featured = document.getElementById('newsFeatured').checked;
            const imageFile = document.getElementById('newsImage').files[0];

            if (!title || !content) {
                showNewsStatus('‚ö†Ô∏è Please fill in title and content', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('title', title);
            formData.append('content', content);
            formData.append('category', category);
            formData.append('priority', priority);
            formData.append('featured', featured);

            if (imageFile) {
                formData.append('image', imageFile);
                showNewsStatus(`üì§ Uploading image (${(imageFile.size / 1024).toFixed(2)} KB) and publishing...`, 'loading');
            } else {
                showNewsStatus('üì§ Publishing news article...', 'loading');
            }

            try {
                const response = await fetch('/api/admin/publish-news', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showNewsStatus('‚úÖ News article published successfully!' + (imageFile ? ' (Image uploaded to ImgBB)' : ''), 'success');
                    document.getElementById('newsForm').reset();
                    removeNewsImagePreview();
                    setTimeout(() => {
                        showNewsStatus('', 'hidden');
                    }, 3000);
                } else {
                    showNewsStatus('‚ùå Error: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('News publication error:', error);
                showNewsStatus('‚ùå Error publishing news: ' + error.message, 'error');
            }
        }

        async function parseBulkQuestions() {
            const textarea = document.getElementById('bulkQuestionsInput');
            const text = textarea.value.trim();

            if (!text) {
                alert('‚ùå Please paste your questions first!');
                return;
            }

            const originalBtn = event.target;
            originalBtn.disabled = true;
            originalBtn.innerHTML = '‚è≥ Parsing questions...';

            try {
                const blocks = text.split(/\n\s*\n/).filter(block => block.trim());
                const questions = [];
                const parseErrors = [];

                console.log(`üìö Found ${blocks.length} question blocks to parse`);

                for (let block of blocks) {
                    if (!block.trim()) continue;

                    const question = {};
                    const lines = block.split('\n').map(line => line.trim()).filter(line => line);

                    for (let line of lines) {
                        if (line.toUpperCase().startsWith('QUESTION_ID:')) {
                            question.question_id = line.split(':', 2)[1].trim();
                        } else if (line.toUpperCase().startsWith('QUESTION:')) {
                            question.question = line.split(':', 2)[1].trim();
                        } else if (line.toUpperCase().startsWith('A:')) {
                            question.answer_a = line.split(':', 2)[1].trim();
                        } else if (line.toUpperCase().startsWith('B:')) {
                            question.answer_b = line.split(':', 2)[1].trim();
                        } else if (line.toUpperCase().startsWith('C:')) {
                            question.answer_c = line.split(':', 2)[1].trim();
                        } else if (line.toUpperCase().startsWith('D:')) {
                            question.answer_d = line.split(':', 2)[1].trim();
                        } else if (line.toUpperCase().startsWith('CORRECT:')) {
                            const correct = line.split(':', 2)[1].trim().toUpperCase();
                            if (['A', 'B', 'C', 'D'].includes(correct)) {
                                question.correct = correct;
                            }
                        }
                    }

                    if (question.question_id && question.question && 
                        question.answer_a && question.answer_b && 
                        question.answer_c && question.answer_d && question.correct) {
                        questions.push(question);
                        console.log(`‚úÖ Parsed: ${question.question_id}`);
                    } else {
                        const missing = [];
                        if (!question.question_id) missing.push('QUESTION_ID');
                        if (!question.question) missing.push('QUESTION');
                        if (!question.answer_a) missing.push('A');
                        if (!question.answer_b) missing.push('B');
                        if (!question.answer_c) missing.push('C');
                        if (!question.answer_d) missing.push('D');
                        if (!question.correct) missing.push('CORRECT');
                        parseErrors.push(`‚ùå ${question.question_id || 'Unknown'}: Missing ${missing.join(', ')}`);
                    }
                }

                if (questions.length === 0) {
                    alert(`‚ùå No valid questions found!\n\nPlease check the format:\n\nQUESTION_ID: Q001\nQUESTION: Your question?\nA: Answer A\nB: Answer B\nC: Answer C\nD: Answer D\nCORRECT: A`);
                    originalBtn.disabled = false;
                    originalBtn.innerHTML = '‚úÖ Add All Questions from Text';
                    return;
                }

                console.log(`üìö Successfully parsed ${questions.length} questions`);

                let successCount = 0;
                let skipCount = 0;
                let errorCount = 0;

                for (let q of questions) {
                    try {
                        const response = await fetch('/api/admin/quiz-questions', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify(q)
                        });

                        const data = await response.json();
                        if (data.success) {
                            successCount++;
                            console.log(`‚úÖ Added: ${q.question_id}`);
                        } else {
                            if (data.error && data.error.includes('already exists')) {
                                skipCount++;
                                console.log(`‚ö†Ô∏è Skipped (duplicate): ${q.question_id}`);
                            } else {
                                errorCount++;
                                console.error(`‚ùå Failed: ${q.question_id} - ${data.error}`);
                            }
                        }
                    } catch (error) {
                        errorCount++;
                        console.error(`‚ùå Error adding ${q.question_id}:`, error);
                    }
                }

                let resultMsg = `‚úÖ Upload Complete!\n\n`;
                resultMsg += `üìä Total Questions Found: ${questions.length}\n`;
                resultMsg += `‚úÖ Successfully Added: ${successCount}\n`;
                if (skipCount > 0) resultMsg += `‚ö†Ô∏è Skipped (Duplicates): ${skipCount}\n`;
                if (errorCount > 0) resultMsg += `‚ùå Failed: ${errorCount}\n`;
                if (parseErrors.length > 0) {
                    resultMsg += `\n‚ö†Ô∏è Parse Errors:\n${parseErrors.join('\n')}`;
                }

                alert(resultMsg);

                textarea.value = '';
                await loadQuestions();

                originalBtn.disabled = false;
                originalBtn.innerHTML = '‚úÖ Add All Questions from Text';

            } catch (error) {
                console.error('‚ùå Bulk parse error:', error);
                alert('‚ùå Error parsing questions: ' + error.message);
                originalBtn.disabled = false;
                originalBtn.innerHTML = '‚úÖ Add All Questions from Text';
            }
        }

        async function uploadQuestionsFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                const questionBlocks = text.split(/\n\s*\n/).filter(block => block.trim());
                const questions = [];

                for (let block of questionBlocks) {
                    const question = {};
                    const idMatch = block.match(/QUESTION_ID:\s*(\S+)/i);
                    if (idMatch) question.question_id = idMatch[1].trim();
                    const questionMatch = block.match(/QUESTION:\s*(.+?)\s*A:/s);
                    if (questionMatch) question.question = questionMatch[1].trim();
                    const aMatch = block.match(/A:\s*(.+?)\s*B:/s);
                    const bMatch = block.match(/B:\s*(.+?)\s*C:/s);
                    const cMatch = block.match(/C:\s*(.+?)\s*D:/s);
                    const dMatch = block.match(/D:\s*(.+?)\s*CORRECT:/s);
                    if (aMatch) question.answer_a = aMatch[1].trim();
                    if (bMatch) question.answer_b = bMatch[1].trim();
                    if (cMatch) question.answer_c = cMatch[1].trim();
                    if (dMatch) question.answer_d = dMatch[1].trim();
                    const correctMatch = block.match(/CORRECT:\s*([A-D])/i);
                    if (correctMatch) question.correct = correctMatch[1].toUpperCase();

                    if (question.question_id && question.question && 
                        question.answer_a && question.answer_b && 
                        question.answer_c && question.answer_d && question.correct) {
                        questions.push(question);
                    } else {
                        console.warn('Incomplete question found:', question);
                    }
                }

                if (questions.length === 0) {
                    alert('‚ùå No valid questions found in file. Please check the format.\n\nExpected format:\nQUESTION_ID: Q001\nQUESTION: Your question here?\nA: Answer A\nB: Answer B\nC: Answer C\nD: Answer D\nCORRECT: A');
                    return;
                }

                console.log(`üìö Found ${questions.length} valid questions to upload`);

                let successCount = 0;
                let failCount = 0;

                for (let question of questions) {
                    try {
                        const response = await fetch('/api/admin/quiz-questions', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify(question)
                        });

                        const data = await response.json();
                        if (data.success) {
                            successCount++;
                            console.log(`‚úÖ Added question ${question.question_id}`);
                        } else {
                            failCount++;
                            console.error(`‚ùå Failed to add question ${question.question_id}:`, data.error);
                        }
                    } catch (error) {
                        failCount++;
                        console.error(`‚ùå Error adding question ${question.question_id}:`, error);
                    }
                }

                alert(`‚úÖ Upload complete!\n\nSuccess: ${successCount}\nFailed: ${failCount}\nTotal found: ${questions.length}`);
                await loadQuestions();
                event.target.value = '';

            } catch (error) {
                console.error('File upload error:', error);
                alert('‚ùå Error reading file: ' + error.message);
            }
        }

        async function loadCommunityStoriesNotifications() {
            try {
                const response = await fetch('/community-stories/api/admin/notifications');
                const data = await response.json();

                if (data.success && data.notifications.length > 0) {
                    const notificationsHtml = `
                        <div style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(251, 191, 36, 0.1); border-left: 4px solid #fbbf24; border-radius: 8px;">
                            <strong style="color: #fbbf24;">üì¨ You have ${data.count} pending submission(s) waiting for review</strong>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Submission ID</th>
                                    <th>User Wallet</th>
                                    <th>Tweet Link / Screenshot</th>
                                    <th>Submitted At</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.notifications.map((n, index) => {
                                    const sub = n.community_stories_submissions;
                                    return `
                                        <tr id="submission-row-${sub.submission_id}" style="background: rgba(251, 191, 36, 0.05);">
                                            <td style="font-weight: 600; color: #fbbf24;">${index + 1}</td>
                                            <td style="font-family: monospace; font-weight: 600;">${sub.submission_id}</td>
                                            <td style="font-family: monospace;">${sub.wallet_address.substring(0,8)}...${sub.wallet_address.substring(sub.wallet_address.length - 6)}</td>
                                            <td>
                                                ${sub.storage_path ? `
                                                    <div style="max-width: 200px;">
                                                        <img src="${sub.storage_path}" alt="Screenshot" style="width: 100%; border-radius: 8px; border: 2px solid rgba(99, 102, 241, 0.3);" onclick="window.open('${sub.storage_path}', '_blank')">
                                                        <small style="display: block; margin-top: 0.25rem; color: #6b7280;">Click to enlarge</small>
                                                    </div>
                                                ` : `
                                                    <a href="${sub.tweet_url}" target="_blank" style="color: #3b82f6; text-decoration: underline;">
                                                        üîó Open Tweet
                                                    </a>
                                                `}
                                            </td>
                                            <td style="font-size: 0.9rem;">${new Date(sub.submitted_at).toLocaleString()}</td>
                                            <td>
                                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                                    <button class="btn btn-primary" 
                                                        onclick="approveSubmission('${sub.submission_id}', 'low')" 
                                                        style="padding: 0.4rem 0.8rem; font-size: 0.85rem; background: linear-gradient(135deg, #6366f1, #a855f7);">
                                                        üí∞ Low (2,000 G$)
                                                    </button>
                                                    <button class="btn btn-primary" 
                                                        onclick="approveSubmission('${sub.submission_id}', 'high')" 
                                                        style="padding: 0.4rem 0.8rem; font-size: 0.85rem; background: linear-gradient(135deg, #10b981, #059669);">
                                                        üíé High (5,000 G$)
                                                    </button>
                                                    <button class="btn btn-danger" 
                                                        onclick="rejectSubmission('${sub.submission_id}')" 
                                                        style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">
                                                        ‚ùå Reject
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('communityStoriesNotifications').innerHTML = notificationsHtml;
                } else {
                    document.getElementById('communityStoriesNotifications').innerHTML = `
                        <div style="padding: 2rem; text-align: center; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border: 1px dashed rgba(16, 185, 129, 0.3);">
                            <p style="color: #10b981; font-size: 1.1rem;">‚úÖ No pending submissions</p>
                            <p style="color: rgba(241, 245, 249, 0.6); font-size: 0.9rem; margin-top: 0.5rem;">All submissions have been reviewed!</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading community stories:', error);
                document.getElementById('communityStoriesNotifications').innerHTML = '<p style="color: #ef4444;">Error loading submissions</p>';
            }
        }

        async function loadCommunityStoriesHistory() {
            try {
                const response = await fetch('/community-stories/api/admin/history');
                const data = await response.json();

                if (data.success && data.history.length > 0) {
                    const historyHtml = `
                        <div style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-left: 4px solid #10b981; border-radius: 8px;">
                            <strong style="color: #10b981;">‚úÖ ${data.count} submission(s) processed</strong>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Submission ID</th>
                                    <th>User</th>
                                    <th>Status</th>
                                    <th>Amount</th>
                                    <th>Reviewed By</th>
                                    <th>Reviewed At</th>
                                    <th>TX Hash</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.history.map(h => {
                                    let statusBadge = '';
                                    let statusColor = '';
                                    let amountDisplay = '';

                                    if (h.status === 'approved_low') {
                                        statusBadge = '‚úÖ Approved (Low)';
                                        statusColor = '#10b981';
                                        amountDisplay = '2,000 G$';
                                    } else if (h.status === 'approved_high') {
                                        statusBadge = '‚úÖ Approved (High)';
                                        statusColor = '#10b981';
                                        amountDisplay = '5,000 G$';
                                    } else if (h.status === 'rejected') {
                                        statusBadge = '‚ùå Rejected';
                                        statusColor = '#ef4444';
                                        amountDisplay = '-';
                                    }

                                    return `
                                        <tr style="background: rgba(255, 255, 255, 0.02);">
                                            <td style="font-family: monospace; font-weight: 600;">${h.submission_id}</td>
                                            <td style="font-family: monospace; font-size: 0.85rem;">${h.wallet_address.substring(0,8)}...</td>
                                            <td>
                                                <span style="color: ${statusColor}; font-weight: 600; font-size: 0.9rem;">
                                                    ${statusBadge}
                                                </span>
                                            </td>
                                            <td style="font-weight: 600; color: ${statusColor};">${amountDisplay}</td>
                                            <td style="font-family: monospace; font-size: 0.85rem;">${h.reviewed_by ? h.reviewed_by.substring(0,8) + '...' : 'N/A'}</td>
                                            <td style="font-size: 0.85rem;">${new Date(h.reviewed_at).toLocaleString()}</td>
                                            <td style="font-family: monospace; font-size: 0.85rem;">
                                                ${h.transaction_hash ? 
                                                    `<a href="https://celoscan.io/tx/${h.transaction_hash}" target="_blank" style="color: #3b82f6;">
                                                        ${h.transaction_hash.substring(0,10)}...
                                                    </a>` 
                                                    : '-'}
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('communityStoriesHistory').innerHTML = historyHtml;
                } else {
                    document.getElementById('communityStoriesHistory').innerHTML = `
                        <div style="padding: 1.5rem; text-align: center; background: rgba(255, 255, 255, 0.02); border-radius: 8px;">
                            <p style="color: rgba(241, 245, 249, 0.5);">No action history yet</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading history:', error);
                document.getElementById('communityStoriesHistory').innerHTML = '<p style="color: #ef4444;">Error loading history</p>';
            }
        }

        async function approveSubmission(submissionId, rewardType) {
            const rewardAmount = rewardType === 'low' ? '2,000' : '5,000';

            if (!confirm(`‚úÖ Approve submission ${submissionId}?\n\nüí∞ Reward: ${rewardAmount} G$\nüîó This will send G$ tokens to the user's wallet.`)) {
                return;
            }

            const row = document.getElementById(`submission-row-${submissionId}`);
            if (row) {
                row.style.opacity = '0.5';
                row.innerHTML = `
                    <td colspan="6" style="text-align: center; padding: 1.5rem;">
                        <div class="spinner" style="margin: 0 auto 1rem;"></div>
                        <p style="color: #fbbf24;">‚è≥ Processing approval and disbursing ${rewardAmount} G$...</p>
                    </td>
                `;
            }

            try {
                const response = await fetch('/community-stories/api/admin/approve', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({submission_id: submissionId, reward_type: rewardType})
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Submission Approved Successfully!\n\nüí∞ Amount: ${data.amount} G$\nüîó Transaction: ${data.tx_hash.substring(0, 20)}...\n\n‚ú® The submission has been removed from pending list.`);

                    await loadCommunityStoriesNotifications();
                    await loadCommunityStoriesHistory();
                } else {
                    alert('‚ùå Error: ' + data.error);
                    await loadCommunityStoriesNotifications();
                }
            } catch (error) {
                console.error('Error approving:', error);
                alert('‚ùå Error approving submission: ' + error.message);
                await loadCommunityStoriesNotifications();
            }
        }

        async function rejectSubmission(submissionId) {
            const reason = prompt('‚ùå Reject submission ' + submissionId + '\n\nReason for rejection (optional):');

            if (reason === null) {
                return;
            }

            const row = document.getElementById(`submission-row-${submissionId}`);
            if (row) {
                row.style.opacity = '0.5';
                row.innerHTML = `
                    <td colspan="6" style="text-align: center; padding: 1.5rem;">
                        <div class="spinner" style="margin: 0 auto 1rem;"></div>
                        <p style="color: #ef4444;">‚è≥ Processing rejection...</p>
                    </td>
                `;
            }

            try {
                const response = await fetch('/community-stories/api/admin/reject', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({submission_id: submissionId, reason: reason})
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Submission ${submissionId} has been rejected.\n\n${reason ? 'üìù Reason: ' + reason : ''}‚ú® The submission has been removed from pending list.`);

                    await loadCommunityStoriesNotifications();
                    await loadCommunityStoriesHistory();
                } else {
                    alert('‚ùå Error: ' + data.error);
                    await loadCommunityStoriesNotifications();
                }
            } catch (error) {
                console.error('Error rejecting:', error);
                alert('‚ùå Error rejecting submission: ' + error.message);
                await loadCommunityStoriesNotifications();
            }
        }

        async function loadCommunityStoriesSettings() {
            try {
                const response = await fetch('/api/admin/community-stories-settings');
                const data = await response.json();

                const statusDiv = document.getElementById('community-stories-settings-status');
                const controlsDiv = document.getElementById('community-stories-settings-controls');

                if (data.success) {
                    const settings = data.settings;

                    document.getElementById('current-low-reward').textContent = settings.low_reward.toLocaleString() + ' G$';
                    document.getElementById('current-high-reward').textContent = settings.high_reward.toLocaleString() + ' G$';
                    document.getElementById('current-window-startDay').textContent = settings.window_start_day + 'th';
                    document.getElementById('current-window-end').textContent = settings.window_end_day + 'th';
                    document.getElementById('current-mentions').textContent = settings.required_mentions;

                    document.getElementById('low-reward').value = settings.low_reward;
                    document.getElementById('high-reward').value = settings.high_reward;
                    document.getElementById('required-mentions').value = settings.required_mentions;
                    document.getElementById('window-start-day').value = settings.window_start_day;
                    document.getElementById('window-end-day').value = settings.window_end_day;
                    document.getElementById('community-stories-message').value = settings.message || '';

                    statusDiv.style.display = 'none';
                    controlsDiv.style.display = 'block';
                } else {
                    statusDiv.innerHTML = '<p style="color: #ef4444;">Error loading settings</p>';
                }
            } catch (error) {
                console.error('Error loading Community Stories settings:', error);
                document.getElementById('community-stories-settings-status').innerHTML = '<p style="color: #ef4444;">Error loading settings</p>';
            }
        }

        async function updateCommunityStoriesSettings() {
            try {
                const lowReward = parseFloat(document.getElementById('low-reward').value);
                const highReward = parseFloat(document.getElementById('high-reward').value);
                const mentions = document.getElementById('required-mentions').value.trim();
                const startDay = parseInt(document.getElementById('window-start-day').value);
                const endDay = parseInt(document.getElementById('window-end-day').value);
                const message = document.getElementById('community-stories-message').value.trim();

                if (!lowReward || !highReward || !mentions || !startDay || !endDay) {
                    alert('‚ö†Ô∏è Please fill in all required fields');
                    return;
                }

                if (startDay < 1 || startDay > 31 || endDay < 1 || endDay > 31) {
                    alert('‚ö†Ô∏è Days must be between 1 and 31');
                    return;
                }

                if (startDay >= endDay) {
                    alert('‚ö†Ô∏è Start day must be before end day');
                    return;
                }

                const response = await fetch('/api/admin/community-stories-settings', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        low_reward: lowReward,
                        high_reward: highReward,
                        required_mentions: mentions,
                        window_start_day: startDay,
                        window_end_day: endDay,
                        message: message
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Community Stories settings updated successfully!\n\n` +
                          `üí∞ Text Post: ${lowReward} G$\n` +
                          `üíé Video Post: ${highReward} G$\n` +
                          `üìÖ Window: ${startDay}th - ${endDay}th\n` +
                          `üìã Mentions: ${mentions}\n` +
                          `üìù Message: ${message ? 'Updated' : 'Not set'}`);
                    await loadCommunityStoriesSettings();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error updating settings:', error);
                alert('‚ùå Error updating settings: ' + error.message);
            }
        }

        async function loadInsufficientBalanceMessage() {
            try {
                const response = await fetch('/api/admin/insufficient-balance-message');
                const data = await response.json();

                const statusDiv = document.getElementById('insufficient-balance-status');
                const controlsDiv = document.getElementById('insufficient-balance-controls');

                if (data.success) {
                    const message = data.message || 'G$ funds have been depleted. Please try to contact us at t.me/GoodDollarX';

                    document.getElementById('current-insufficient-message-text').textContent = message;
                    document.getElementById('insufficient-balance-message').value = message;

                    statusDiv.style.display = 'none';
                    controlsDiv.style.display = 'block';
                } else {
                    statusDiv.innerHTML = '<p style="color: #ef4444;">Error loading message</p>';
                }
            } catch (error) {
                console.error('Error loading insufficient balance message:', error);
                document.getElementById('insufficient-balance-status').innerHTML = '<p style="color: #ef4444;">Error loading message</p>';
            }
        }

        async function updateInsufficientBalanceMessage() {
            try {
                const message = document.getElementById('insufficient-balance-message').value.trim();

                if (!message) {
                    alert('‚ö†Ô∏è Please enter an error message');
                    return;
                }

                const response = await fetch('/api/admin/insufficient-balance-message', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ message: message })
                });

                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ Error message updated successfully!');
                    await loadInsufficientBalanceMessage();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error updating message:', error);
                alert('‚ùå Error updating message: ' + error.message);
            }
        }

        async function loadPendingDailyTasks() {
            try {
                const response = await fetch('/api/admin/daily-tasks/pending');
                const data = await response.json();

                const contentDiv = document.getElementById('dailyTasksContent');

                if (data.success) {
                    const telegramTasks = data.telegram_tasks || [];
                    const twitterTasks = data.twitter_tasks || [];
                    const facebookTasks = data.facebook_tasks || [];
                    const totalPending = data.total_pending || 0;

                    let html = '';

                    if (totalPending === 0) {
                        html = `
                            <div style="padding: 2rem; text-align: center; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border: 1px dashed rgba(16, 185, 129, 0.3);">
                                <p style="color: #10b981; font-size: 1.1rem;">‚úÖ No pending submissions</p>
                                <p style="color: rgba(241, 245, 249, 0.6); font-size: 0.9rem; margin-top: 0.5rem;">All tasks have been reviewed!</p>
                            </div>
                        `;
                    } else {
                        html += `
                            <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(251, 191, 36, 0.1); border-left: 4px solid #fbbf24; border-radius: 8px;">
                                <strong style="color: #fbbf24;">‚è≥ ${totalPending} pending submission(s) waiting for review</strong>
                            </div>
                        `;

                        if (facebookTasks.length > 0) {
                            html += `
                                <h3 style="color: #1877f2; margin-top: 2rem; margin-bottom: 1rem;">üìò Facebook Tasks (${facebookTasks.length})</h3>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Wallet</th>
                                            <th>Facebook Post</th>
                                            <th>Reward</th>
                                            <th>Submitted</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                            `;

                            facebookTasks.forEach((task, index) => {
                                html += `
                                    <tr id="task-facebook-${task.id}">
                                        <td>${index + 1}</td>
                                        <td style="font-family: monospace;">${task.wallet_address.substring(0,8)}...${task.wallet_address.substring(task.wallet_address.length - 6)}</td>
                                        <td>
                                            <a href="${task.url}" target="_blank" style="color: #1877f2; text-decoration: underline;">
                                                üìò View Post
                                            </a>
                                        </td>
                                        <td style="font-weight: 600; color: #10b981;">${task.reward_amount} G$</td>
                                        <td style="font-size: 0.9rem;">${new Date(task.created_at).toLocaleString()}</td>
                                        <td>
                                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                                <button class="btn btn-primary" onclick="approveDailyTask(${task.id}, 'facebook')" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">
                                                    ‚úÖ Approve
                                                </button>
                                                <button class="btn btn-danger" onclick="rejectDailyTask(${task.id}, 'facebook')" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">
                                                    ‚ùå Reject
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            });

                            html += `
                                    </tbody>
                                </table>
                            `;
                        }

                        if (twitterTasks.length > 0) {
                            html += '<h3 style="color: #3b82f6; margin-top: 2rem; margin-bottom: 1rem;">üê¶ Twitter Tasks (${twitterTasks.length})</h3>';
                            html += '<table><thead><tr><th>#</th><th>Wallet</th><th>Tweet Link</th><th>Reward</th><th>Submitted</th><th>Actions</th></tr></thead><tbody>';

                            twitterTasks.forEach((task, index) => {
                                html += `
                                    <tr id="task-twitter-${task.id}">
                                        <td>${index + 1}</td>
                                        <td style="font-family: monospace;">${task.wallet_address.substring(0,8)}...${task.wallet_address.substring(task.wallet_address.length - 6)}</td>
                                        <td><a href="${task.url}" target="_blank" style="color: #3b82f6; text-decoration: underline;">üîó View Tweet</a></td>
                                        <td>${task.reward_amount} G$</td>
                                        <td style="font-size: 0.9rem;">${new Date(task.created_at).toLocaleString()}</td>
                                        <td>
                                            <button class="btn btn-primary" onclick="approveDailyTask(${task.id}, 'twitter')" style="margin-right: 0.5rem; padding: 0.4rem 0.8rem; font-size: 0.85rem; background: linear-gradient(135deg, #10b981, #059669);">
                                                ‚úÖ Approve
                                            </button>
                                            <button class="btn btn-danger" onclick="rejectDailyTask(${task.id}, 'twitter')" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">
                                                ‚ùå Reject
                                            </button>
                                        </td>
                                    </tr>
                                `;
                            });

                            html += '</tbody></table>';
                        }

                        if (telegramTasks.length > 0) {
                            html += '<h3 style="color: #00acee; margin-top: 2rem; margin-bottom: 1rem;">üì± Telegram Tasks (${telegramTasks.length})</h3>';
                            html += '<table><thead><tr><th>#</th><th>Wallet</th><th>Post Link</th><th>Reward</th><th>Submitted</th><th>Actions</th></tr></thead><tbody>';

                            telegramTasks.forEach((task, index) => {
                                html += `
                                    <tr id="task-telegram-${task.id}">
                                        <td>${index + 1}</td>
                                        <td style="font-family: monospace;">${task.wallet_address.substring(0,8)}...${task.wallet_address.substring(task.wallet_address.length - 6)}</td>
                                        <td><a href="${task.url}" target="_blank" style="color: #00acee; text-decoration: underline;">üîó View Post</a></td>
                                        <td>${task.reward_amount} G$</td>
                                        <td style="font-size: 0.9rem;">${new Date(task.created_at).toLocaleString()}</td>
                                        <td>
                                            <button class="btn btn-primary" onclick="approveDailyTask(${task.id}, 'telegram')" style="margin-right: 0.5rem; padding: 0.4rem 0.8rem; font-size: 0.85rem; background: linear-gradient(135deg, #6366f1, #a855f7);">
                                                ‚úÖ Approve
                                            </button>
                                            <button class="btn btn-danger" onclick="rejectDailyTask(${task.id}, 'telegram')" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">
                                                ‚ùå Reject
                                            </button>
                                        </td>
                                    </tr>
                                `;
                            });

                            html += '</tbody></table>';
                        }
                    }

                    contentDiv.innerHTML = html;
                } else {
                    contentDiv.innerHTML = '<p style="color: #ef4444;">Error loading pending tasks</p>';
                }
            } catch (error) {
                console.error('Error loading pending tasks:', error);
                document.getElementById('dailyTasksContent').innerHTML = '<p style="color: #ef4444;">Error loading pending tasks</p>';
            }
        }

        async function approveDailyTask(submissionId, platform) {
            if (!confirm(`Approve this ${platform} submission and disburse reward?`)) {
                return;
            }

            try {
                const response = await fetch('/api/admin/daily-tasks/approve', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        submission_id: submissionId,
                        platform: platform
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ ${data.message}\nTX: ${data.tx_hash}`);
                    const row = document.getElementById(`task-${platform}-${submissionId}`);
                    if (row) row.remove();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error approving task:', error);
                alert('‚ùå Error approving task: ' + error.message);
            }
        }

        async function rejectDailyTask(submissionId, platform) {
            const reason = prompt('Enter rejection reason (optional):');
            if (reason === null) return; 

            try {
                const response = await fetch('/api/admin/daily-tasks/reject', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        submission_id: submissionId,
                        platform: platform,
                        reason: reason
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ ${data.message}`);
                    const row = document.getElementById(`task-${platform}-${submissionId}`);
                    if (row) row.remove();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error rejecting task:', error);
                alert('‚ùå Error rejecting task: ' + error.message);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('screenshotFile');
            const imagePreview = document.getElementById('imagePreview');
            const uploadForm = document.getElementById('uploadScreenshotForm');
            const statusDiv = document.getElementById('uploadStatusMessage');

            if (!fileInput || !imagePreview || !uploadForm || !statusDiv) return;

            fileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imagePreview.innerHTML = `
                            <img src="${e.target.result}" alt="Screenshot Preview" 
                                 style="max-width: 100%; max-height: 300px; border-radius: 8px;">
                        `;
                    }
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.innerHTML = '<small style="color: rgba(241, 245, 249, 0.5);">Image preview will appear here</small>';
                }
            });

            uploadForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                const walletAddress = document.getElementById('screenshotWallet').value.trim();
                const fileInput = document.getElementById('screenshotFile');

                if (!fileInput.files || fileInput.files.length === 0) {
                    statusDiv.style.display = 'block';
                    statusDiv.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
                    statusDiv.style.color = '#ef4444';
                    statusDiv.textContent = '‚ùå Please select an image file to upload.';
                    return;
                }

                try {
                    statusDiv.style.display = 'block';
                    statusDiv.style.backgroundColor = 'rgba(251, 191, 36, 0.1)';
                    statusDiv.style.color = '#fbbf24';
                    statusDiv.textContent = '‚è≥ Uploading to ImgBB...';

                    const formData = new FormData();
                    formData.append('image', fileInput.files[0]);
                    formData.append('wallet_address', walletAddress);

                    const response = await fetch('/community-stories/api/admin/upload-screenshot', {
                        method: 'POST',
                        body: formData
                    });

                    const data = await response.json();

                    if (data.success) {
                        statusDiv.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
                        statusDiv.style.color = '#10b981';
                        statusDiv.innerHTML = `
                            ‚úÖ Screenshot uploaded successfully!<br>
                            <small>Submission ID: ${data.submission_id}</small><br>
                            <small>URL: <a href="${data.screenshot_url}" target="_blank" style="color: #60a5fa;">${data.screenshot_url}</a></small>
                        `;

                        uploadForm.reset();
                        imagePreview.innerHTML = '<small style="color: rgba(241, 245, 249, 0.5);">Image preview will appear here</small>';

                        setTimeout(() => {
                            loadCommunityStoriesHistory();
                        }, 1500);
                    } else {
                        statusDiv.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
                        statusDiv.style.color = '#ef4444';
                        statusDiv.textContent = '‚ùå Error: ' + data.error;
                    }
                } catch (error) {
                    console.error('Upload error:', error);
                    statusDiv.style.display = 'block';
                    statusDiv.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
                    statusDiv.style.color = '#ef4444';
                    statusDiv.textContent = '‚ùå Upload failed: ' + error.message;
                }
            });
        });

        async function loadCommunityStories() {
            console.log('Loading community stories...');
        }

        function updateBroadcastPreview() {
            const title = document.getElementById('broadcast-title').value || 'Message Title';
            const message = document.getElementById('broadcast-message').value || 'Your message will appear here...';

            document.getElementById('preview-title').textContent = title;
            document.getElementById('preview-message').textContent = message;
        }

        function testVoiceMessage() {
            const message = document.getElementById('broadcast-message').value;
            if (!message) {
                alert('‚ö†Ô∏è Please enter a message first');
                return;
            }

            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(message);
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 1;
                utterance.lang = 'en-US';
                window.speechSynthesis.speak(utterance);
                alert('üîä Playing test voice message...');
            } else {
                alert('‚ùå Voice not supported in this browser');
            }
        }

        async function sendBroadcastMessage() {
            try {
                const title = document.getElementById('broadcast-title').value.trim();
                const message = document.getElementById('broadcast-message').value.trim();

                if (!title || !message) {
                    alert('‚ö†Ô∏è Please enter both title and message');
                    return;
                }

                if (!confirm(`üì¢ Send this message to ALL users?\n\nTitle: ${title}\n\nThis will appear in everyone's inbox.`)) {
                    return;
                }

                const response = await fetch('/api/admin/broadcast-message', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({title: title, message: message})
                });

                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ Broadcast message sent successfully!\n\nAll users will see this message in their inbox.');

                    document.getElementById('broadcast-title').value = '';
                    document.getElementById('broadcast-message').value = '';

                    await loadBroadcastMessages();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error sending broadcast:', error);
                alert('‚ùå Error sending broadcast message: ' + error.message);
            }
        }

        async function loadBroadcastMessages() {
            try {
                const response = await fetch('/api/admin/broadcast-messages?limit=50');
                const data = await response.json();

                const tableDiv = document.getElementById('broadcastMessagesTable');

                if (data.success && data.messages.length > 0) {
                    const messagesHtml = `
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Title</th>
                                    <th>Message</th>
                                    <th>Status</th>
                                    <th>Sent At</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.messages.map((msg, index) => `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td style="font-weight: 600;">${msg.title}</td>
                                        <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${msg.message}</td>
                                        <td>
                                            ${msg.is_active 
                                                ? '<span style="color: #10b981; font-weight: 600;">‚úÖ Active</span>' 
                                                : '<span style="color: #6b7280;">‚ùå Inactive</span>'}
                                        </td>
                                        <td style="font-size: 0.9rem;">${new Date(msg.created_at).toLocaleString()}</td>
                                        <td>
                                            ${msg.is_active 
                                                ? `<button class="btn btn-danger" onclick="deleteBroadcastMessage(${msg.id})" style="padding: 0.3rem 0.8rem; font-size: 0.85rem;">üóëÔ∏è Deactivate</button>`
                                                : '<span style="color: #6b7280;">Inactive</span>'}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    tableDiv.innerHTML = messagesHtml;
                } else {
                    tableDiv.innerHTML = '<p style="text-align: center; color: rgba(241, 245, 249, 0.6);">No broadcast messages yet</p>';
                }
            } catch (error) {
                console.error('Error loading broadcasts:', error);
                document.getElementById('broadcastMessagesTable').innerHTML = '<p style="color: #ef4444;">Error loading broadcast messages</p>';
            }
        }

        async function deleteBroadcastMessage(broadcastId) {
            if (!confirm('Deactivate this broadcast message?\n\nIt will no longer appear in user inboxes.')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/broadcast-message/${broadcastId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ Broadcast message deactivated');
                    await loadBroadcastMessages();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error deleting broadcast:', error);
                alert('‚ùå Error deactivating message: ' + error.message);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Show overview section by default
            showSection('overview-section');

            const requirementImageFile = document.getElementById('requirementImageFile');
            if (requirementImageFile) {
                requirementImageFile.addEventListener('change', handleRequirementImagePreview);
            }

            const uploadRequirementImageForm = document.getElementById('uploadRequirementImageForm');
            if (uploadRequirementImageForm) {
                uploadRequirementImageForm.addEventListener('submit', uploadRequirementImage);
            }
        });

        function handleRequirementImagePreview(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('requirementImagePreview');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <img src="${e.target.result}" style="max-width: 100%; max-height: 300px; border-radius: 8px;">
                    `;
                };
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = '<small style="color: rgba(241, 245, 249, 0.5);">üì∑ Requirement image preview will appear here</small>';
            }
        }

        async function uploadRequirementImage(event) {
            event.preventDefault();

            const fileInput = document.getElementById('requirementImageFile');
            const titleInput = document.getElementById('requirementImageTitle');
            const statusMessage = document.getElementById('requirementImageStatusMessage');

            if (!fileInput.files || fileInput.files.length === 0) {
                statusMessage.style.display = 'block';
                statusMessage.style.background = 'rgba(239, 68, 68, 0.2)';
                statusMessage.style.color = '#ef4444';
                statusMessage.textContent = '‚ùå Please select an image file';
                return;
            }

            const file = fileInput.files[0];
            const title = titleInput.value.trim();

            statusMessage.style.display = 'block';
            statusMessage.style.background = 'rgba(251, 191, 36, 0.2)';
            statusMessage.style.color = '#fbbf24';
            statusMessage.textContent = '‚è≥ Uploading requirement image to ImgBB...';

            try {
                const formData = new FormData();
                formData.append('image', file);
                formData.append('title', title);
                formData.append('image_type', 'requirement');

                const response = await fetch('/community-stories/api/admin/upload-requirement-image', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    statusMessage.style.background = 'rgba(16, 185, 129, 0.2)';
                    statusMessage.style.color = '#10b981';
                    statusMessage.textContent = `‚úÖ Requirement image uploaded successfully!`;

                    fileInput.value = '';
                    titleInput.value = '';
                    document.getElementById('requirementImagePreview').innerHTML = '<small style="color: rgba(241, 245, 249, 0.5);">üì∑ Requirement image preview will appear here</small>';

                    loadRecentRequirementImages();

                    setTimeout(() => {
                        statusMessage.style.display = 'none';
                    }, 3000);
                } else {
                    statusMessage.style.background = 'rgba(239, 68, 68, 0.2)';
                    statusMessage.style.color = '#ef4444';
                    statusMessage.textContent = `‚ùå Error: ${data.error || 'Upload failed'}`;
                }
            } catch (error) {
                console.error('Upload error:', error);
                statusMessage.style.background = 'rgba(239, 68, 68, 0.2)';
                statusMessage.style.color = '#ef4444';
                statusMessage.textContent = `‚ùå Upload error: ${error.message}`;
            }
        }

        async function loadRecentRequirementImages() {
            try {
                const response = await fetch('/community-stories/api/admin/requirement-images?limit=10');
                const data = await response.json();

                if (data.success && data.images && data.images.length > 0) {
                    const recentDiv = document.getElementById('recentRequirementImages');
                    const listDiv = document.getElementById('recentRequirementImagesList');

                    recentDiv.style.display = 'block';
                    listDiv.innerHTML = data.images.map(img => `
                        <div style="min-width: 200px; background: rgba(255,255,255,0.05); border-radius: 8px; padding: 0.5rem;">
                            <img src="${img.screenshot_url}" alt="${img.title || 'Requirement Image'}" 
                                 style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 0.5rem;">
                            <div style="font-size: 0.85rem; color: rgba(241, 245, 249, 0.9);">
                                ${img.title || 'No title'}
                            </div>
                            <div style="font-size: 0.75rem; color: rgba(241, 245, 249, 0.6); margin-top: 0.25rem;">
                                ${new Date(img.created_at).toLocaleDateString()}
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading recent requirement images:', error);
            }
        }

        async function loadNewsHistory() {
            try {
                const response = await fetch('/api/admin/news-history');
                const data = await response.json();

                const tableDiv = document.getElementById('newsHistoryTable');

                if (data.success && data.news && data.news.length > 0) {
                    const tableHtml = `
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Priority</th>
                                    <th>Featured</th>
                                    <th>Created</th>
                                    <th>Views</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.news.map(article => `
                                    <tr>
                                        <td>${article.id}</td>
                                        <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${article.title}</td>
                                        <td>${article.category}</td>
                                        <td><span style="padding: 0.25rem 0.5rem; border-radius: 4px; background: ${article.priority === 'high' ? '#ef4444' : article.priority === 'medium' ? '#fbbf24' : '#10b981'}; color: white; font-size: 0.8rem;">${article.priority}</span></td>
                                        <td>${article.featured ? '‚≠ê Yes' : 'No'}</td>
                                        <td>${new Date(article.created_at).toLocaleDateString()}</td>
                                        <td>${article.view_count || 0} views</td>
                                        <td>
                                            <a href="/news/article/${article.id}" target="_blank" class="btn btn-primary" style="padding: 0.3rem 0.6rem; font-size: 0.85rem; margin-right: 0.5rem;">üëÅÔ∏è View</a>
                                            <button class="btn btn-danger" onclick="deleteNews(${article.id}, '${article.title.replace(/'/g, "\\'")}')" style="padding: 0.3rem 0.6rem; font-size: 0.85rem;">üóëÔ∏è Delete</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    tableDiv.innerHTML = tableHtml;
                } else {
                    tableDiv.innerHTML = '<p style="text-align: center; color: rgba(241, 245, 249, 0.6);">No news articles found</p>';
                }
            } catch (error) {
                console.error('‚ùå Error loading news history:', error);
                document.getElementById('newsHistoryTable').innerHTML = '<p style="color: #ef4444;">Error loading news history</p>';
            }
        }

        async function deleteNews(newsId, newsTitle) {
            if (!confirm(`‚ö†Ô∏è Are you sure you want to delete this news article?\n\n"${newsTitle}"\n\nThis action cannot be undone!`)) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/news/${newsId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ News article deleted successfully!`);
                    await loadNewsHistory();
                } else {
                    alert('‚ùå Error: ' + data.error);
                }
            } catch (error) {
                console.error('‚ùå Error deleting news:', error);
                alert('‚ùå Error deleting news article');
            }
        }

        async function loadModuleLinks() {
            try {
                const response = await fetch('/api/admin/module-links');
                const data = await response.json();

                const tableDiv = document.getElementById('moduleLinksTable');

                if (data.success && data.links && data.links.length > 0) {
                    const stripHtml = (html) => {
                        if (!html) return '';
                        const tmp = document.createElement('div');
                        tmp.innerHTML = html;
                        return tmp.textContent || tmp.innerText || '';
                    };
                    const linksHtml = `
                        <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Order</th>
                                    <th>Title</th>
                                    <th>URL</th>
                                    <th>Description</th>
                                    <th>Reading Time</th>
                                    <th>Content</th>
                                    <th>Active</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.links.map(link => {
                                    const urlDisplay = link.url ? (link.url.length > 50 ? link.url.substring(0, 50) + '...' : link.url) : '';
                                    const urlCell = link.url ? `<a href="${link.url}" target="_blank" style="color: #6366f1;">${urlDisplay}</a>` : '<span style="color: rgba(241,245,249,0.5);">N/A</span>';
                                    const contentPreview = stripHtml(link.content);
                                    const contentDisplay = contentPreview.length > 100 ? contentPreview.substring(0, 100) + '...' : (contentPreview || 'N/A');
                                    const activeIndicator = link.is_active ? '<span style="color: #22c55e; font-weight: 600;">‚óè Active</span>' : '<span style="color: #ef4444; font-weight: 600;">‚óè Inactive</span>';
                                    return `
                                    <tr>
                                        <td>${link.display_order}</td>
                                        <td>${link.title}</td>
                                        <td>${urlCell}</td>
                                        <td>${link.description || 'N/A'}</td>
                                        <td>${link.reading_time_minutes || 'N/A'} min</td>
                                        <td style="max-width: 200px; font-size: 0.85rem; color: rgba(241,245,249,0.7);">${contentDisplay}</td>
                                        <td>${activeIndicator}</td>
                                        <td style="white-space: nowrap;">
                                            <button class="btn btn-primary" onclick="editModuleLink(${link.id})" style="padding: 0.4rem 0.8rem; margin-right: 0.5rem;">
                                                ‚úèÔ∏è Edit
                                            </button>
                                            <button class="btn btn-danger" onclick="deleteModuleLink(${link.id})" style="padding: 0.4rem 0.8rem;">
                                                üóëÔ∏è Delete
                                            </button>
                                        </td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                        </div>
                    `;
                    tableDiv.innerHTML = linksHtml;
                } else {
                    tableDiv.innerHTML = '<p style="color: rgba(241, 245, 249, 0.7);">No module links found. Add one above.</p>';
                }
            } catch (error) {
                console.error('Error loading module links:', error);
                tableDiv.innerHTML = '<p style="color: #ef4444;">Error loading module links: ' + error.message + '</p>';
            }
        }

        async function editModuleLink(linkId) {
            try {
                const response = await fetch('/api/admin/module-links');
                const data = await response.json();

                if (!data.success || !data.links) {
                    alert('‚ùå Failed to load module link data');
                    return;
                }

                const link = data.links.find(l => l.id === linkId);
                if (!link) {
                    alert('‚ùå Module link not found');
                    return;
                }

                document.getElementById('editModuleLinkId').value = link.id;
                document.getElementById('editModuleLinkTitle').value = link.title || '';
                document.getElementById('editModuleLinkUrl').value = link.url || '';
                document.getElementById('editModuleLinkDescription').value = link.description || '';
                document.getElementById('editModuleLinkContent').value = link.content || '';
                document.getElementById('editModuleLinkReadingTime').value = link.reading_time_minutes || 5;
                document.getElementById('editModuleLinkOrder').value = link.display_order || 1;
                document.getElementById('editModuleLinkActive').value = link.is_active ? 'true' : 'false';

                document.getElementById('editModuleLinkModal').style.display = 'block';
            } catch (error) {
                console.error('Error loading module link:', error);
                alert('‚ùå Error loading module link: ' + error.message);
            }
        }

        function closeEditModuleLinkModal() {
            document.getElementById('editModuleLinkModal').style.display = 'none';
        }

        async function updateModuleLink() {
            const linkId = document.getElementById('editModuleLinkId').value;
            const title = document.getElementById('editModuleLinkTitle').value.trim();
            const url = document.getElementById('editModuleLinkUrl').value.trim();
            const description = document.getElementById('editModuleLinkDescription').value.trim();
            const content = document.getElementById('editModuleLinkContent').value.trim();
            const readingTime = parseInt(document.getElementById('editModuleLinkReadingTime').value) || 5;
            const displayOrder = parseInt(document.getElementById('editModuleLinkOrder').value) || 1;
            const isActive = document.getElementById('editModuleLinkActive').value === 'true';

            if (!title) {
                alert('‚ö†Ô∏è Title is required!');
                return;
            }

            try {
                const response = await fetch(`/api/admin/module-links/${linkId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title,
                        url,
                        description,
                        content,
                        reading_time_minutes: readingTime,
                        display_order: displayOrder,
                        is_active: isActive
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ Module link updated successfully!');
                    closeEditModuleLinkModal();
                    await loadModuleLinks();
                } else {
                    alert('‚ùå Error: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error updating module link:', error);
                alert('‚ùå Error updating module link: ' + error.message);
            }
        }

        async function deleteModuleLink(linkId) {
            if (!confirm('Are you sure you want to delete this module link?')) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/module-links/${linkId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    alert('‚úÖ Module link deleted successfully!');
                    await loadModuleLinks();
                } else {
                    alert('‚ùå Error: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error deleting module link:', error);
                alert('‚ùå Error deleting module link: ' + error.message);
            }
        }

        (function() {
            const form = document.getElementById('addModuleLinkForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await addModuleLink(e);
                });
            }
        })();

        async function addModuleLink(submitEvent) {
            const title = document.getElementById('newModuleLinkTitle').value.trim();
            const url = document.getElementById('newModuleLinkUrl').value.trim();
            const description = document.getElementById('newModuleLinkDescription').value.trim();
            const content = document.getElementById('newModuleLinkContent').value.trim();
            const readingTime = parseInt(document.getElementById('newModuleLinkReadingTime').value) || 5;
            const displayOrder = parseInt(document.getElementById('newModuleLinkOrder').value) || 1;

            if (!title) {
                alert('‚ö†Ô∏è Title is required!');
                return;
            }

            const submitBtn = submitEvent.target.querySelector('button[type="submit"]');

            try {
                const willAutoScrape = url && !content;
                if (willAutoScrape) {
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.textContent = 'ü§ñ Auto-scraping content from URL...';
                        submitBtn.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                    }
                }

                const response = await fetch('/api/admin/module-links', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title,
                        url,
                        description,
                        content,
                        reading_time_minutes: readingTime,
                        display_order: displayOrder
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const wasAutoScraped = url && !content;
                    const successMsg = wasAutoScraped 
                        ? '‚úÖ Module link added successfully!\nü§ñ Content auto-scraped from URL!'
                        : '‚úÖ Module link added successfully!';
                    alert(successMsg);

                    document.getElementById('newModuleLinkTitle').value = '';
                    document.getElementById('newModuleLinkUrl').value = '';
                    document.getElementById('newModuleLinkDescription').value = '';
                    document.getElementById('newModuleLinkContent').value = '';
                    document.getElementById('newModuleLinkReadingTime').value = '5';
                    document.getElementById('newModuleLinkOrder').value = '1';

                    await loadModuleLinks();
                } else {
                    alert('‚ùå Error: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error adding module link:', error);
                alert('‚ùå Error adding module link: ' + error.message);
            } finally {
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = '‚ûï Add Module Link';
                    submitBtn.style.background = '';
                }
            }
        }
    </script>
    <script>
        async function loadRewardConfig() {
            try {
                const statusDiv = document.getElementById('reward-config-status');
                const controlsDiv = document.getElementById('reward-config-controls');

                const response = await fetch('/api/admin/reward-config');
                const data = await response.json();

                if (data.success && data.rewards) {
                    if (data.rewards.telegram_task) {
                        document.getElementById('current-telegram-reward').textContent = 
                            `${parseFloat(data.rewards.telegram_task.amount).toLocaleString()} G$`;
                        document.getElementById('telegram-reward-input').value = 
                            parseFloat(data.rewards.telegram_task.amount);
                        if (data.rewards.telegram_task.last_updated_at) {
                            document.getElementById('telegram-last-updated').textContent = 
                                `Last updated: ${new Date(data.rewards.telegram_task.last_updated_at).toLocaleString()}`;
                        }
                    }

                    if (data.rewards.twitter_task) {
                        document.getElementById('current-twitter-reward').textContent = 
                            `${parseFloat(data.rewards.twitter_task.amount).toLocaleString()} G$`;
                        document.getElementById('twitter-reward-input').value = 
                            parseFloat(data.rewards.twitter_task.amount);
                        if (data.rewards.twitter_task.last_updated_at) {
                            document.getElementById('twitter-last-updated').textContent = 
                                `Last updated: ${new Date(data.rewards.twitter_task.last_updated_at).toLocaleString()}`;
                        }
                    }

                    if (data.rewards.facebook_task) {
                        document.getElementById('current-facebook-reward').textContent = 
                            `${parseFloat(data.rewards.facebook_task.amount).toLocaleString()} G$`;
                        document.getElementById('facebook-reward-input').value = 
                            parseFloat(data.rewards.facebook_task.amount);
                        if (data.rewards.facebook_task.last_updated_at) {
                            document.getElementById('facebook-last-updated').textContent = 
                                `Last updated: ${new Date(data.rewards.facebook_task.last_updated_at).toLocaleString()}`;
                        }
                    }

                    statusDiv.style.display = 'none';
                    controlsDiv.style.display = 'block';
                } else {
                    statusDiv.innerHTML = '<p style="color: #ef4444;">Failed to load reward configuration</p>';
                }
            } catch (error) {
                console.error('Error loading reward config:', error);
                document.getElementById('reward-config-status').innerHTML = 
                    '<p style="color: #ef4444;">Error loading configuration</p>';
            }
        }

        async function updateRewardConfig(taskType) {
            try {
                let inputId, displayId, taskName;

                if (taskType === 'telegram_task') {
                    inputId = 'telegram-reward-input';
                    displayId = 'current-telegram-reward';
                    taskName = 'Telegram';
                } else if (taskType === 'twitter_task') {
                    inputId = 'twitter-reward-input';
                    displayId = 'current-twitter-reward';
                    taskName = 'Twitter';
                } else if (taskType === 'facebook_task') {
                    inputId = 'facebook-reward-input';
                    displayId = 'current-facebook-reward';
                    taskName = 'Facebook';
                }

                const newAmount = parseFloat(document.getElementById(inputId).value);

                if (isNaN(newAmount) || newAmount < 10 || newAmount > 10000) {
                    alert('Please enter a valid reward amount between 10 and 10,000 G$');
                    return;
                }

                if (!confirm(`Update ${taskName} task reward to ${newAmount} G$?`)) {
                    return;
                }

                const response = await fetch('/api/admin/reward-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        task_type: taskType,
                        reward_amount: newAmount
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ ${taskName} reward updated to ${newAmount} G$`);

                    document.getElementById(displayId).textContent = `${newAmount.toLocaleString()} G$`;

                    await loadRewardConfig();
                } else {
                    alert(`‚ùå Error: ${data.error}`);
                }
            } catch (error) {
                console.error('Error updating reward:', error);
                alert('Failed to update reward configuration');
            }
        }
    </script>
</body>
</html>
